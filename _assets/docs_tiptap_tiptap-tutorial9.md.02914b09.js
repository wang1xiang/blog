import{f as i,g as l,J as t}from"./common-03e46d7f.js";const o='{"title":"word多人协作socket服务流程图","frontmatter":{"date":"2024-02-29","title":"word多人协作socket服务流程图","tags":["tiptap"],"describe":null},"headers":[{"level":2,"title":"前端","slug":"前端"}],"relativePath":"docs/tiptap/tiptap-tutorial9.md","lastUpdated":1714994542522.548}';var r={};const s=[t('<p>html 使用接口判断权限相关，以跳转页面 socket 数据读取、保存、缓存 接口：由 socket 调用以保存数据并生成历史记录</p><p><img src="/blog/_assets/word-yjs-socket.802eda0a.png" alt="word-yjs-socket"></p><h2 id="前端"><a class="header-anchor" href="#前端" aria-hidden="true">#</a> 前端</h2><p>word 使用 tipap 框架（一个基于 ProseMirror 的在线编辑器框架） 多人协作使用 yjs</p><ol><li>访问 api/doc/info 接口以校验权限</li><li>权限校验完成后，创建 tiptap 实例 <ol><li>本地创建 YDoc</li><li>生成 title 和 prosemirror 子节点（title 不属于 tiptap，所以需要单独处理，prosemirror 用于存放 tiptap 内容）</li><li>绑定 prosemirror 与 tiptap 变更同步</li><li>创建 socket 连接（携带 token 及 uid）</li><li>监听 ydoc 变更及光标位置</li></ol></li><li>socket 服务 <ol><li>校验 token</li><li>校验服务器文档状态： <strong>正在恢复历史断开连接</strong></li><li>校验客户断文档版本号：<strong>重连才会携带，不一致通知</strong>、客户断刷新页面</li><li>下发服务器文档版本号</li><li>下发服务器文档内容</li></ol></li><li>记录版本号，掉线重连时携带（掉线后版本号有变化刷新页面，版本号 = 恢复的历史 ID || 文档 ID）</li><li>使用服务器下发内容渲染文档内容</li><li>tiptap 实例 initSuccess<strong>编辑按钮可点击、或自动进入编辑态</strong></li><li>编辑内容或标题 <strong>ydoc 发现变更并发送</strong></li><li>服务端：收到 ydoc 变更下发给其它端</li><li>客户端：收到服务器变更，yjs 合并内容</li><li>掉线，打开断网遮罩 <ol><li>携带 服务器文档版本号 重连</li><li>恢复同步后</li></ol></li></ol>',5)];r.render=function(t,o,r,e,a,p){return i(),l("div",null,s)};export{o as __pageData,r as default};
