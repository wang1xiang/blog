import{f as n,g as s,J as a}from"./common-03e46d7f.js";const t='{"title":"ç©éWebä¸­çš„â€œé€‰åŒºâ€å’Œâ€œèŒƒå›´â€ï¼Œä¸‹æ¬¡ä¸è¦å†ç™¾åº¦äº†","frontmatter":{"date":"2023-09-05","title":"ç©éWebä¸­çš„â€œé€‰åŒºâ€å’Œâ€œèŒƒå›´â€ï¼Œä¸‹æ¬¡ä¸è¦å†ç™¾åº¦äº†","tags":["work"],"describe":"å¹³æ—¶æ²¡å°‘é‡åˆ°Selectionå’ŒRangeå¯¹è±¡å§ï¼Ÿæ‰€ä»¥ä½ ææ¸…æ¥šä»–ä»¬åˆ†åˆ«æ˜¯ä»€ä¹ˆäº†å—ï¼Ÿæ²¡æœ‰å°±æ¥å¥½å¥½å­¦ä¹ ã€‚"},"headers":[{"level":2,"title":"å‰è¨€","slug":"å‰è¨€"},{"level":2,"title":"document.execCommand","slug":"document-execcommand"},{"level":2,"title":"é€‰åŒº & èŒƒå›´","slug":"é€‰åŒº-èŒƒå›´"},{"level":3,"title":"æ˜¯ä»€ä¹ˆ","slug":"æ˜¯ä»€ä¹ˆ"},{"level":3,"title":"å¦‚ä½•è·å–","slug":"å¦‚ä½•è·å–"},{"level":3,"title":"å¸¸ç”¨æ“ä½œ","slug":"å¸¸ç”¨æ“ä½œ"},{"level":3,"title":"å®ç°æœ€åˆçš„éœ€æ±‚ï¼šè®°å½•é€‰åŒºå¹¶æ¢å¤","slug":"å®ç°æœ€åˆçš„éœ€æ±‚ï¼šè®°å½•é€‰åŒºå¹¶æ¢å¤"},{"level":2,"title":"æ€»ç»“","slug":"æ€»ç»“"}],"relativePath":"docs/work/contentEdit-div-insert.md","lastUpdated":1742378303222.6125}';var e={};const o=[a('<h2 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€" aria-hidden="true">#</a> å‰è¨€</h2><p>æœ€è¿‘æœ‰ä¸ªéœ€æ±‚ï¼Œä¸€ä¸ªçº¯æ–‡æœ¬çš„è¯„è®ºåŠŸèƒ½ï¼Œä½†æ˜¯è¯„è®ºä¸­éœ€è¦å®ç° <code>@ åŠŸèƒ½</code>ï¼Œç±»ä¼¼äº antd çš„ <a href="https://www.antdv.com/components/mentions-cn" target="_blank" rel="noopener noreferrer">Mentions</a>ç»„ä»¶ï¼Œä¸è¿‡åœ¨æ ·å¼ä¸Šæœ‰ç‰¹å®šçš„è¦æ±‚ã€‚å®è´¨å°±æ˜¯åœ¨ä¸€æ®µçº¯æ–‡æœ¬ä¸­ï¼Œæ·»åŠ ä¸€äº› html ç‰‡æ®µã€‚</p><p>é¦–å…ˆæƒ³åˆ°çš„æ˜¯å¼•å…¥ä¸€ä¸ªå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œç±»ä¼¼ wangEditorã€quill ç­‰ï¼Œä½†æ˜¯ä¸€ä¸ªè¿™ä¹ˆå°çš„åŠŸèƒ½å¥½åƒå¹¶æ²¡æœ‰å¿…è¦ï¼Œä¸€æ˜¯éº»çƒ¦äºŒæ˜¯å¢åŠ åŒ…çš„ä½“ç§¯ã€‚äºæ˜¯å°±ç”¨ <code>contenteditable=&#39;true&#39;</code> ç”Ÿæˆä¸€ä¸ªå¯ç¼–è¾‘ div æ¥å®Œæˆã€‚</p><p>ä¸ºæ­¤å­¦ä¹ äº† <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand" target="_blank" rel="noopener noreferrer">document.execCommand</a> ä»¥åŠç”¨äºæ“ä½œé€‰åŒºçš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection" target="_blank" rel="noopener noreferrer">Selection</a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range" target="_blank" rel="noopener noreferrer">Range</a> APIã€‚</p><h2 id="document-execcommand"><a class="header-anchor" href="#document-execcommand" aria-hidden="true">#</a> document.execCommand</h2><p>document.execCommand å¯ä»¥è¯´æ˜¯å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„æ ¸å¿ƒ APIï¼Œå°½ç®¡ document.execCommand å·²ç»è¢« MDN ç»™åºŸå¼ƒäº†ã€‚</p><p>é€šè¿‡ document.execCommand å¯ä»¥å®ç°å¯¹å¯ç¼–è¾‘æ–‡æ¡£æ‰§è¡Œé¢„å®šä¹‰çš„å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š</p><div class="language-javascript"><pre><code><span class="token comment">// åŠ ç²—</span>\ndocument<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&#39;bold&#39;</span><span class="token punctuation">)</span>\n<span class="token comment">// æ–œä½“</span>\ndocument<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&#39;italic&#39;</span><span class="token punctuation">)</span>\n<span class="token comment">// å­—ä½“</span>\ndocument<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&#39;fontSize&#39;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>\n</code></pre></div><p>å…³äº document.execCommand çš„æ›´å¤šåŠŸèƒ½å¯æŸ¥çœ‹<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand" target="_blank" rel="noopener noreferrer">MDN</a>ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å¯ä»¥æ¥ä¸€ä¸ªå®é™…çš„æ¡ˆä¾‹çœ‹çœ‹ï¼š</p><div class="language-js"><pre><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Document<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>style type<span class="token operator">=</span><span class="token string">&quot;text/css&quot;</span><span class="token operator">&gt;</span>\n      <span class="token punctuation">.</span>btn<span class="token operator">-</span>group <span class="token punctuation">{</span>\n        <span class="token literal-property property">margin</span><span class="token operator">:</span> 15px <span class="token number">0</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token punctuation">.</span>btn <span class="token punctuation">{</span>\n        <span class="token literal-property property">color</span><span class="token operator">:</span> #<span class="token number">494949</span><span class="token punctuation">;</span>\n        background<span class="token operator">-</span>color<span class="token operator">:</span> #fff<span class="token punctuation">;</span>\n        <span class="token literal-property property">border</span><span class="token operator">:</span> 1px solid #<span class="token number">494949</span><span class="token punctuation">;</span>\n        border<span class="token operator">-</span>radius<span class="token operator">:</span> 5px<span class="token punctuation">;</span>\n        <span class="token literal-property property">cursor</span><span class="token operator">:</span> pointer<span class="token punctuation">;</span>\n        margin<span class="token operator">-</span>top<span class="token operator">:</span> 10px<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token punctuation">.</span>editor <span class="token punctuation">{</span>\n        <span class="token literal-property property">border</span><span class="token operator">:</span> 1px solid #<span class="token number">424242</span><span class="token punctuation">;</span>\n        <span class="token literal-property property">width</span><span class="token operator">:</span> 800px<span class="token punctuation">;</span>\n        <span class="token literal-property property">height</span><span class="token operator">:</span> 500px<span class="token punctuation">;</span>\n        <span class="token literal-property property">padding</span><span class="token operator">:</span> 8px 12px<span class="token punctuation">;</span>\n        border<span class="token operator">-</span>radius<span class="token operator">:</span> 6px<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      a <span class="token punctuation">{</span>\n        <span class="token literal-property property">cursor</span><span class="token operator">:</span> pointer<span class="token punctuation">;</span>\n        text<span class="token operator">-</span>decoration<span class="token operator">:</span> none<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn-group&quot;</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;æ’¤é”€&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;undo&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;æ¢å¤&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;redo&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;åŠ ç²—&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;bold&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;å€¾æ–œ&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;italic&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;ä¸‹åˆ’çº¿&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;underline&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;åˆ é™¤çº¿&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;strikeThrough&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;è®¾ç½®å­—ä½“å¤§å°&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;fontSize&quot;</span> data<span class="token operator">-</span>value<span class="token operator">=</span><span class="token string">&quot;22&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;å­—ä½“èƒŒæ™¯è‰²&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;backColor&quot;</span> data<span class="token operator">-</span>value<span class="token operator">=</span><span class="token string">&quot;#FFFF02&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;å­—ä½“é¢œè‰²&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;foreColor&quot;</span> data<span class="token operator">-</span>value<span class="token operator">=</span><span class="token string">&quot;#FF0000&quot;</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>\n\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;é“¾æ¥&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;createLink&quot;</span> data<span class="token operator">-</span>value<span class="token operator">=</span><span class="token string">&quot;https://www.baidu.com/&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;æœ‰åºåˆ—è¡¨&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;insertOrderedList&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;æ— åºåˆ—è¡¨&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;insertUnorderedList&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;å‰ªåˆ‡é€‰ä¸­æ–‡å­—&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;cut&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;å¤åˆ¶é€‰ä¸­æ–‡å­—&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;copy&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;åˆ é™¤é€‰ä¸­æ–‡å­—&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;delete&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n\n      <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;æ¸…é™¤æ ¼å¼&quot;</span> data<span class="token operator">-</span>commandid<span class="token operator">=</span><span class="token string">&quot;removeFormat&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;editor&quot;</span> contenteditable<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> width<span class="token operator">=</span><span class="token string">&quot;800px&quot;</span> height<span class="token operator">=</span><span class="token string">&quot;500px&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>\n      window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> target <span class="token operator">=</span> event<span class="token punctuation">.</span>target\n          <span class="token keyword">const</span> <span class="token punctuation">{</span> commandid<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> target<span class="token punctuation">.</span>dataset\n          document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span>commandid<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">const</span> btnGroup <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.btn-group&#39;</span><span class="token punctuation">)</span>\n        <span class="token comment">// äº‹ä»¶ä»£ç†ï¼Œç»™æŒ‰é’®çˆ¶çº§ç»‘å®šç‚¹å‡»äº‹ä»¶</span>\n        btnGroup<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>\n</code></pre></div><p><a href="https://codepen.io/wang1xiang/pen/qBLpRVJ" target="_blank" rel="noopener noreferrer">ğŸ‘‰ğŸ» é¢„è§ˆåœ°å€</a></p><p>é€šè¿‡ä½“éªŒä¸Šé¢çš„ Demo ä¹‹åï¼Œæˆ–è®¸ä½ ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Ÿé‚£å°±æ˜¯<strong>æ¯æ¬¡ç‚¹å®ŒåŠŸèƒ½æŒ‰é’®åæ–‡æœ¬æ¡†å¤±ç„¦ï¼Œéœ€è¦å†æ¬¡ç‚¹å‡»ä½¿å…¶èšç„¦</strong>ã€‚</p><p>è¿™ç‚¹å°±æ¯”è¾ƒæ¶å¿ƒäº†ï¼Œéš¾ä¸æˆè¦æˆ‘æ¯æ¬¡ç‚¹å‡»æ–‡æœ¬æ¡†æ‰è¡Œ ğŸ˜”ã€‚</p><p>é‚£ä¹ˆä½¿ç”¨ä»€ä¹ˆæ–¹æ³•èƒ½å¤Ÿåœ¨ç‚¹å‡»ç¼–è¾‘å™¨å¤–éƒ¨åŠŸèƒ½æŒ‰é’®æ—¶ç»§ç»­è®©ç¼–è¾‘å™¨è·å–ç„¦ç‚¹å‘¢ï¼Ÿ</p><p>å¥½åŠï¼Œåªéœ€è¦åœ¨ç‚¹å‡»æŒ‰é’®æ‰§è¡Œ execCommand å‘½ä»¤çš„åŒæ—¶è°ƒç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/focus" target="_blank" rel="noopener noreferrer">focus</a> æ–¹æ³•å³å¯ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">item</span><span class="token operator">:</span> ToolType</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> commandId<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> item\n  editorRef<span class="token punctuation">.</span>value<span class="token operator">?.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span>commandId<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>é‚£ä¹ˆé™¤äº† focus ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„æ–¹æ³•å—ï¼Ÿå¸¦ç€é—®é¢˜ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection" target="_blank" rel="noopener noreferrer">Selection</a>ï¼ˆé€‰åŒºï¼‰å’Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range" target="_blank" rel="noopener noreferrer">Range</a>ï¼ˆèŒƒå›´ï¼‰è¿™ä¸¤ä¸ªå®¶ä¼™ã€‚</p><h2 id="é€‰åŒº-èŒƒå›´"><a class="header-anchor" href="#é€‰åŒº-èŒƒå›´" aria-hidden="true">#</a> é€‰åŒº &amp; èŒƒå›´</h2><h3 id="æ˜¯ä»€ä¹ˆ"><a class="header-anchor" href="#æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> æ˜¯ä»€ä¹ˆ</h3><p><img src="/blog/_assets/selection-range.21292089.png" alt="selection-range"></p><p>ä¸Šé¢æ˜¯æˆ‘åœ¨ Firefox æµè§ˆå™¨ä¸­çš„ demoï¼Œ<strong>èŒƒå›´æŒ‡çš„å°±æ˜¯é¡µé¢ä¸Šçš„æ¯ä¸€ä¸ªé€‰ä¸­èŠ‚ç‚¹æˆ–èŠ‚ç‚¹éƒ¨åˆ†æ–‡å­—</strong>ï¼Œå³ä¸Šå›¾ä¸­çš„æ¯ä¸ªçº¢æ¡†å†…çš„å†…å®¹ï¼ˆåªæœ‰ Firefox å¯ä»¥é€‰æ‹©å¤šä¸ªèŒƒå›´ï¼Œå…¶ä»–æµè§ˆå™¨åªèƒ½é€‰æ‹©å•ä¸ªèŒƒå›´ï¼‰ï¼Œæ¯ä¸ªéƒ½æœ‰èµ·å§‹ä½ç½®å’Œç»ˆæ­¢ä½ç½®ï¼Œ<strong>é€‰åŒºæŒ‡çš„å°±æ˜¯æ‰€æœ‰èŒƒå›´çš„é›†åˆ</strong>ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹ MDN ä¸­çš„ä»‹ç»ï¼š</p><h4 id="range-èŒƒå›´"><a class="header-anchor" href="#range-èŒƒå›´" aria-hidden="true">#</a> Range èŒƒå›´</h4><ul><li>èŒƒå›´æŒ‡çš„æ˜¯æ–‡æ¡£ä¸­è¿ç»­çš„ä¸€éƒ¨åˆ†ã€‚ä¸€ä¸ªèŒƒå›´åŒ…æ‹¬æ•´ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥åŒ…å«èŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚æ–‡æœ¬èŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†ï¼›</li><li>é€šå¸¸åªèƒ½é€‰æ‹©ä¸€ä¸ªèŒƒå›´ï¼Œä½†åœ¨ Firefox æµè§ˆå™¨ä¸­å¯ä»¥é€‰æ‹©å¤šä¸ªèŒƒå›´ï¼›</li><li>Range å¯¹è±¡ä¹Ÿèƒ½é€šè¿‡ DOM åˆ›å»ºã€å¢åŠ ã€åˆ å‡ã€‚</li></ul><h4 id="selection-é€‰åŒº"><a class="header-anchor" href="#selection-é€‰åŒº" aria-hidden="true">#</a> Selection é€‰åŒº</h4><ul><li>è¡¨ç¤ºç”¨æˆ·é€‰æ‹©çš„æ–‡æœ¬èŒƒå›´æˆ–å…‰æ ‡çš„å½“å‰ä½ç½®ï¼Œ<strong>å…‰æ ‡ä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„é€‰åŒº</strong>ï¼›</li><li>ä»£è¡¨é¡µé¢ä¸­çš„æ–‡æœ¬é€‰åŒºï¼Œå¯èƒ½æ¨ªè·¨å¤šä¸ªå…ƒç´ ï¼›</li><li><strong>é€‰æ‹©çš„èµ·ç‚¹ anchorNode è¢«ç§°ä¸ºé”šç‚¹ï¼ˆanchorï¼‰ï¼Œç»ˆç‚¹ focusNode è¢«ç§°ä¸ºç„¦ç‚¹ï¼ˆfocusï¼‰</strong></li></ul><h3 id="å¦‚ä½•è·å–"><a class="header-anchor" href="#å¦‚ä½•è·å–" aria-hidden="true">#</a> å¦‚ä½•è·å–</h3><h4 id="è·å–é€‰åŒº"><a class="header-anchor" href="#è·å–é€‰åŒº" aria-hidden="true">#</a> è·å–é€‰åŒº</h4><p>é€šè¿‡<code>window.getSelection()</code>å³å¯è·å–åˆ° Selection å¯¹è±¡ï¼Œå¦‚ä¸‹ï¼ˆç¬¬ä¸€å¼ ä¸º Chrome æµè§ˆå™¨ï¼Œç¬¬äºŒå¼ ä¸º Firefox æµè§ˆå™¨ï¼‰ï¼š</p><p><strong>Chrome</strong></p><p><img src="/blog/_assets/window-getSelection.22c006b6.png" alt="window-getSelection"></p><p><strong>Firefox</strong></p><p><img src="/blog/_assets/window-getSelection-firefox.c6f2313b.png" alt="window-getSelection-firefox"></p><p>å¯ä»¥çœ‹åˆ° Chrome æµè§ˆå™¨å’Œ Firefox è¿”å›çš„ç»“æ„ç•¥æœ‰å·®å¼‚ï¼ŒbaseNode å’Œ extentNode ä»…åœ¨ Chrome æµè§ˆå™¨ä¸­æœ‰ï¼Œå¹¶ä¸”ç›¸å…³çš„å®šä¹‰åœ¨ MDN ä¸­å¹¶ä¸èƒ½æŸ¥åˆ°ã€‚</p><p>é€šè¿‡<a href="https://stackoverflow.com/questions/27241281/what-is-anchornode-basenode-extentnode-and-focusnode-in-the-object-returned" target="_blank" rel="noopener noreferrer">è¿™ä¸ªå›ç­”</a>äº†è§£åˆ°ï¼š<strong>baseNode å’Œ extentNode åˆ†åˆ«æ˜¯ anchorNode å’Œ focusNode çš„åˆ«å</strong>ã€‚</p><p>Selection æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</p><ul><li><a href="https://developer.mozilla.org/docs/Web/API/Selection/anchorNode" target="_blank" rel="noopener noreferrer">anchorNode</a>: é€‰åŒºå¼€å§‹ä½ç½®æ‰€å±çš„èŠ‚ç‚¹å…ƒç´ ï¼›</li><li><a href="https://developer.mozilla.org/docs/Web/API/Selection/anchorOffset" target="_blank" rel="noopener noreferrer">anchorOffset</a>: ä»£è¡¨é€‰åŒºèµ·ç‚¹åœ¨ anchorNode ä¸­çš„åç§»é‡ï¼Œä¾‹å¦‚é€‰åŒºä» anchorNode çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹ï¼Œåˆ™è¿”å› 0ï¼›</li><li><a href="https://developer.mozilla.org/docs/Web/API/Selection/focusNode" target="_blank" rel="noopener noreferrer">focusNode</a>: é€‰åŒºç»“æŸä½ç½®æ‰€å±çš„èŠ‚ç‚¹å…ƒç´ ï¼›</li><li><a href="https://developer.mozilla.org/docs/Web/API/Selection/focusOffset" target="_blank" rel="noopener noreferrer">focusOffset</a>: ä»£è¡¨é€‰åŒºç»ˆç‚¹åœ¨ focusNode ä¸­çš„åç§»é‡ï¼Œä¾‹å¦‚é€‰åŒºåœ¨ focusNode çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å‰ç»“æŸï¼Œåˆ™è¿”å› 0ï¼›</li><li><a href="https://developer.mozilla.org/docs/Web/API/Selection/isCollapsed" target="_blank" rel="noopener noreferrer">isCollapsed</a>: æœªé€‰æ‹©ä»»ä½•å†…å®¹ï¼ˆç©ºèŒƒå›´ï¼‰æˆ–ä¸å­˜åœ¨çš„é€‰å–ä¸º trueï¼Œä¾‹å¦‚å…‰æ ‡çš„ isCollapsed ä¸º trueï¼›</li><li><a href="https://developer.mozilla.org/docs/Web/API/Selection/rangeCount" target="_blank" rel="noopener noreferrer">rangeCount</a>: è¿”å›é€‰å–ä¸­èŒƒå›´çš„æ•°é‡ï¼Œé»˜è®¤æ˜¯ 1ï¼ŒFirefox æµè§ˆå™¨è¿”å›å¯èƒ½å¤§äº 1ï¼›</li><li><a href="https://developer.mozilla.org/docs/Web/API/Selection/type" target="_blank" rel="noopener noreferrer">type</a>: å½“å‰é€‰æ‹©ç±»å‹ï¼š <ul><li>None: å½“å‰æ²¡æœ‰é€‰æ‹©</li><li>Caret: é€‰åŒºå·²æŠ˜å ï¼ˆå³ å…‰æ ‡åœ¨å­—ç¬¦ä¹‹é—´ï¼Œå¹¶æœªå¤„äºé€‰ä¸­çŠ¶æ€ï¼‰</li><li>Range: é€‰æ‹©çš„æ˜¯ä¸€ä¸ªèŒƒå›´ã€‚</li></ul></li></ul><h4 id="è·å–èŒƒå›´"><a class="header-anchor" href="#è·å–èŒƒå›´" aria-hidden="true">#</a> è·å–èŒƒå›´</h4><p>æˆ‘ä»¬åœ¨ä¸Šé¢è¯´äº†é€‰åŒºæ˜¯æ‰€æœ‰èŒƒå›´çš„é›†åˆï¼Œé‚£ä¹ˆé€‰åŒº Selection ä¸€å®šæ˜¯æä¾›äº†è·å– Range çš„ç›¸å…³æ–¹æ³•ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection#%E6%96%B9%E6%B3%95" target="_blank" rel="noopener noreferrer">ğŸ«µ æ¥æŸ¥æˆ‘å‘€</a>ã€‚</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection/getRangeAt" target="_blank" rel="noopener noreferrer">selection.getRangeAt</a> ï¼šç”¨äºè·å–å½“å‰é€‰åŒºå†…çš„ Range å¯¹è±¡ï¼Œä¼ å…¥ä¸€ä¸ªç´¢å¼•ï¼Œè¡¨ç¤ºéœ€è¦è·å–é€‰åŒºä¸­çš„ç¬¬å‡ ä¸ªèŒƒå›´ï¼Œä¸€èˆ¬ä¼  0 å³å¯ï¼Œåªæœ‰åœ¨ Firefox æµè§ˆå™¨ä¸­æ‰ä¼šæœ‰å¤šä¸ªèŒƒå›´ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> range <span class="token operator">=</span> selection<span class="token operator">?.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>\n</code></pre></div><p><img src="/blog/_assets/window-getSelection-getRangeAt.3c7c38cd.png" alt="window-getSelection-getRangeAt"> Range å¯¹è±¡åœ¨ Chrome æµè§ˆå™¨å’Œ Firefox æµè§ˆå™¨çš„è¾“å‡ºç»“æœä¸€è‡´ï¼Œéƒ½åŒ…å«ä¸€ä¸‹å¯¹è±¡ï¼š</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/collapsed" target="_blank" rel="noopener noreferrer">collapsed</a>ï¼šè¡¨ç¤º Range çš„èµ·å§‹ä½ç½®å’Œç»ˆæ­¢ä½ç½®æ˜¯å¦ç›¸åŒï¼Œå¦‚å…‰æ ‡ä¸º trueï¼›</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/commonAncestorContainer" target="_blank" rel="noopener noreferrer">commonAncestorContainer</a>ï¼šè¡¨ç¤ºèŒƒå›´å†…çš„æ‰€æœ‰èŠ‚ç‚¹å®ƒä»¬æœ€è¿‘çš„å…±åŒç¥–å…ˆèŠ‚ç‚¹ï¼›</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/endContainer" target="_blank" rel="noopener noreferrer">endContainer</a>ï¼šè¡¨ç¤ºåŒ…å« Range ç»ˆç‚¹çš„èŠ‚ç‚¹ï¼›</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/endOffset" target="_blank" rel="noopener noreferrer">endOffset</a>ï¼šè¡¨ç¤º Range ç»ˆç‚¹åœ¨ endContainer ä¸­çš„ä½ç½®çš„åç§»;</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/startContainer" target="_blank" rel="noopener noreferrer">startContainer</a>ï¼šè¡¨ç¤ºåŒ…å« Range å¼€å§‹çš„èŠ‚ç‚¹ï¼›</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/startOffset" target="_blank" rel="noopener noreferrer">startOffset</a>ï¼šè¡¨ç¤º Range åœ¨ startContainer ä¸­çš„ä½ç½®çš„åç§»ã€‚</li></ul><h3 id="å¸¸ç”¨æ“ä½œ"><a class="header-anchor" href="#å¸¸ç”¨æ“ä½œ" aria-hidden="true">#</a> å¸¸ç”¨æ“ä½œ</h3><p>å› ä¸º Range å’Œ Seleciton ç›¸å…³çš„ API å¾ˆå¤šï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦è®°ä½ä¸€äº›å¸¸ç”¨çš„å³å¯ï¼Œå…¶ä»–çš„ç­‰ç”¨åˆ°çš„æ—¶å€™å†å»æŸ¥æ–‡æ¡£å³å¯ã€‚</p><p><a href="https://github.com/wang1xiang/simple-editor" target="_blank" rel="noopener noreferrer">ğŸ‘‰ğŸ» æœ¬æ–‡ä»£ç åœ°å€</a></p><p>åœ¨ç»§ç»­å¾€ä¸‹å­¦ä¹ ä¹‹å‰ï¼Œè¯·å…ˆæ‰“å¼€<a href="https://wang1xiang.github.io/simple-editor/" target="_blank" rel="noopener noreferrer">ğŸ‘‰ğŸ» åœ¨çº¿ä½“éªŒåœ°å€</a>ï¼Œæ­é…ä½¿ç”¨ï¼Œæ•ˆæœæ›´ä½³å“¦ ğŸ˜¯</p><h4 id="è·å–å½“å‰é€‰åŒºå†…å®¹"><a class="header-anchor" href="#è·å–å½“å‰é€‰åŒºå†…å®¹" aria-hidden="true">#</a> è·å–å½“å‰é€‰åŒºå†…å®¹</h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection/toString" target="_blank" rel="noopener noreferrer">selection.toString</a> è¿”å›å½“å‰é€‰åŒºçš„çº¯æ–‡æœ¬å†…å®¹ï¼Œ<a href="https://developer.mozilla.org/en-US/docs/Web/API/Range/toString" target="_blank" rel="noopener noreferrer">range.toString</a> è¿”å›æŸä¸ªèŒƒå›´çš„çº¯æ–‡æœ¬å†…å®¹ã€‚</p><div class="language-js"><pre><code>selection<span class="token operator">?.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment">// æˆ–è€…</span>\nselection<span class="token operator">?.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre></div><h4 id="åˆ é™¤å½“å‰é€‰åŒº"><a class="header-anchor" href="#åˆ é™¤å½“å‰é€‰åŒº" aria-hidden="true">#</a> åˆ é™¤å½“å‰é€‰åŒº</h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection/removeRange" target="_blank" rel="noopener noreferrer">selection.removeRange</a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection/removeAllRanges" target="_blank" rel="noopener noreferrer">selection.removeAllRanges</a> éƒ½å¯ä»¥ç”¨äºåˆ é™¤é€‰åŒºï¼Œä¸åŒçš„æ˜¯ removeRange åˆ é™¤æ—¶éœ€è¦æŒ‡å®šç¬¬å‡ ä¸ªèŒƒå›´ï¼Œä¸‹é¢ä¸¤ç§æ–¹æ³•å®ç°çš„æ•ˆæœä¸€è‡´ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> count <span class="token operator">=</span> selection<span class="token operator">?.</span>rangeCount <span class="token operator">||</span> <span class="token number">0</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> range <span class="token operator">=</span> selection<span class="token operator">?.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Range\n  selection<span class="token operator">?.</span><span class="token function">removeRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// or</span>\nselection<span class="token operator">?.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre></div><p><strong>åœ¨ä¸€äº›æ“ä½œå‰éƒ½éœ€è¦å…ˆåˆ é™¤é€‰åŒº</strong>ï¼Œç›´æ¥ä½¿ç”¨ removeAllRanges å³å¯ã€‚</p><h4 id="æ·»åŠ é€‰åŒº"><a class="header-anchor" href="#æ·»åŠ é€‰åŒº" aria-hidden="true">#</a> æ·»åŠ é€‰åŒº</h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection/addRange" target="_blank" rel="noopener noreferrer">selection.addRange</a> æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ªæ–°çš„ range æ·»åŠ åˆ°é€‰åŒºä¸­ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>ä½¿ç”¨ document.createRange æ–¹æ³•åˆ›å»ºä¸€ä¸ª Range å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ new Range åˆ›å»ºï¼›</p></li><li><p>å°†æŒ‡å®šèŒƒå›´æ·»åŠ åˆ°é€‰åŒºä¸­ï¼›</p><p>æŒ‡å®šèŒƒå›´ï¼š<strong>å³é€‰åŒºçš„èµ·å§‹èŒƒå›´å’Œç»ˆæ­¢èŒƒå›´</strong>ï¼Œæœ‰å¤šç§æ–¹æ³•å¯ä»¥å®ç°ï¼š</p><ul><li>ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/selectNode" target="_blank" rel="noopener noreferrer">range.selectNode</a> æˆ– <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/selectNodeContents" target="_blank" rel="noopener noreferrer">range.selectNodeContents</a> æ–¹æ³•å°† DOM èŠ‚ç‚¹æ·»åŠ åˆ° Range ä¸­ï¼Œè¿™æ ·é€‰ä¸­çš„å°±æ˜¯ä¼ å…¥çš„ DOM å…ƒç´ ï¼›</li><li>ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/setStart" target="_blank" rel="noopener noreferrer">range.setStart</a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/setEnd" target="_blank" rel="noopener noreferrer">range.setEnd</a> æ·»åŠ èŒƒå›´çš„è¾¹ç•Œï¼›</li><li>ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/setStartBefore" target="_blank" rel="noopener noreferrer">range.setStartBefore</a>/<a href="https://developer.mozilla.org/en-US/docs/Web/API/Range/setEndBefore" target="_blank" rel="noopener noreferrer">srange.etEndBefore</a> æˆ– <a href="https://developer.mozilla.org/en-US/docs/Web/API/Range/setStartAfter" target="_blank" rel="noopener noreferrer">range.setStartAfter</a>/<a href="https://developer.mozilla.org/en-US/docs/Web/API/Range/setEndAfter" target="_blank" rel="noopener noreferrer">range.setEndAfter</a> æ¥æ·»åŠ èŒƒå›´çš„è¾¹ç•Œã€‚</li></ul></li><li><p>ç§»é™¤å·²æœ‰é€‰åŒºï¼Œé€šè¿‡å°è¯•ï¼Œ<strong>å¦‚æœä¸ç§»é™¤å½“å‰é€‰åŒºçš„è¯ï¼Œé™¤ Firefox å¤–çš„æ‰€æœ‰æµè§ˆå™¨éƒ½å°†å¿½ç•¥æ–°èŒƒå›´</strong>ï¼›</p></li><li><p>æœ€åå°† range èŒƒå›´æ·»åŠ åˆ°é€‰åŒºä¸­ã€‚</p></li></ol><p>ä¸‹é¢è¿™ä¸ª Demo åˆ†åˆ«ç”¨ selectNodeã€setStart å’Œ setStartBefore è¿™å‡ ç§æ–¹æ³•å®ç°ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> editor <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.editor&#39;</span><span class="token punctuation">)</span><span class="token operator">!</span>\n<span class="token keyword">const</span> range <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment">// 1. selectNode é€‰ä¸­ç¬¬nä¸ªå­èŠ‚ç‚¹</span>\n<span class="token comment">// const sizeStr = window.prompt(&#39;é€‰æ‹©ç¬¬å‡ ä¸ªå­èŠ‚ç‚¹&#39;, &#39;1&#39;) || &#39;1&#39;</span>\n<span class="token comment">// const size = parseInt(sizeStr)</span>\n<span class="token comment">// if (isNaN(size)) return</span>\n<span class="token comment">// range.selectNode(editor.childNodes[size])</span>\n\n<span class="token comment">// 2. setStart/setEnd é€‰ä¸­ç¬¬nä¸ªå­èŠ‚ç‚¹åˆ°ç¬¬mä¸ªå­èŠ‚ç‚¹</span>\n<span class="token comment">// const startOffsetStr = window.prompt(&#39;ä»ç¬¬å‡ ä¸ªå­èŠ‚ç‚¹å¼€å§‹&#39;, &#39;1&#39;) || &#39;1&#39;</span>\n<span class="token comment">// const endOffsetStr = window.prompt(&#39;åˆ°ç¬¬å‡ ä¸ªå­èŠ‚ç‚¹ç»“æŸ&#39;, &#39;5&#39;) || &#39;1&#39;</span>\n<span class="token comment">// const startOffset = parseInt(startOffsetStr)</span>\n<span class="token comment">// const endOffset = parseInt(endOffsetStr)</span>\n<span class="token comment">// if (isNaN(startOffset) || isNaN(endOffset)) return</span>\n<span class="token comment">// range.setStart(editor, startOffset)</span>\n<span class="token comment">// range.setEnd(editor, endOffset)</span>\n\n<span class="token comment">// 3. setStart/setEnd é€‰ä¸­ç¬¬nä¸ªå­èŠ‚ç‚¹çš„å¼€å§‹åˆ°ç»“æŸèŒƒå›´</span>\n<span class="token comment">// const n = 1</span>\n<span class="token comment">// const startOffsetStr = window.prompt(&#39;ä»ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹çš„ç¬¬å‡ ä¸ªä½ç½®å¼€å§‹&#39;, &#39;1&#39;) || &#39;1&#39;</span>\n<span class="token comment">// const endOffsetStr = window.prompt(&#39;åˆ°ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹çš„ç¬¬å‡ ä¸ªä½ç½®ç»“æŸ&#39;, &#39;5&#39;) || &#39;1&#39;</span>\n<span class="token comment">// const startOffset = parseInt(startOffsetStr)</span>\n<span class="token comment">// const endOffset = parseInt(endOffsetStr)</span>\n<span class="token comment">// if (isNaN(startOffset) || isNaN(endOffset)) return</span>\n<span class="token comment">// range.setStart(editor.childNodes[n], startOffset)</span>\n<span class="token comment">// range.setEnd(editor.childNodes[n], endOffset)</span>\n\n<span class="token comment">// 4. setStartBefore/setEndBefore é€‰ä¸­ç¬¬nä¸ªå­èŠ‚ç‚¹åˆ°ç¬¬mä¸ªå­èŠ‚ç‚¹</span>\n<span class="token keyword">const</span> startOffsetStr <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">&#39;ä»ç¬¬å‡ ä¸ªå­èŠ‚ç‚¹å‰å¼€å§‹&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;1&#39;</span>\n<span class="token keyword">const</span> endOffsetStr <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">&#39;åˆ°ç¬¬å‡ ä¸ªå­èŠ‚ç‚¹æœ«å°¾ç»“æŸ&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;5&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;1&#39;</span>\n<span class="token keyword">const</span> startOffset <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>startOffsetStr<span class="token punctuation">)</span>\n<span class="token keyword">const</span> endOffset <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>endOffsetStr<span class="token punctuation">)</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>startOffset<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>endOffset<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>\nrange<span class="token punctuation">.</span><span class="token function">setStartBefore</span><span class="token punctuation">(</span>editor<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>startOffset<span class="token punctuation">]</span><span class="token punctuation">)</span>\nrange<span class="token punctuation">.</span><span class="token function">setEndBefore</span><span class="token punctuation">(</span>editor<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>endOffset<span class="token punctuation">]</span><span class="token punctuation">)</span>\n\nselection<span class="token operator">?.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nselection<span class="token operator">?.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span>\n</code></pre></div><p>åœ¨ä¸Šé¢ä»£ç ä¸­ï¼ŒsetStart/setEnd æœ‰ä¸¤ç§ä¸åŒçš„æ•ˆæœ:</p><ol><li><p><strong>ä½œç”¨äºå…ƒç´ èŠ‚ç‚¹æ—¶</strong>ï¼ˆä¸Šè¿° 2. setStart/setEnd é€‰ä¸­ç¬¬ n ä¸ªå­èŠ‚ç‚¹åˆ°ç¬¬ m ä¸ªå­èŠ‚ç‚¹ï¼‰</p><p>æ­¤æ—¶ node è®¾ç½®ä¸º editorï¼Œå³æ•´ä¸ªå¯Œæ–‡æœ¬ï¼Œé‚£ä¹ˆæ­¤æ—¶è®¾å®šçš„ offset å°±æ˜¯å°±æ˜¯å­å…ƒç´ çš„ä½ç½®ã€‚</p></li><li><p><strong>ä½œç”¨äºæ–‡æœ¬èŠ‚ç‚¹æ—¶</strong>ï¼ˆä¸Šè¿° 3. setStart/setEnd é€‰ä¸­ç¬¬ n ä¸ªå­èŠ‚ç‚¹çš„å¼€å§‹åˆ°ç»“æŸèŒƒå›´ï¼‰</p><p>æ­¤æ—¶ node è®¾ç½®ä¸º <code>editor.childNodes[1]</code>, å³ç¬¬ä¸€æ®µè¯ï¼Œé‚£ä¹ˆæ­¤æ—¶è®¾å®šçš„ offset æ˜¯å…¶æ–‡æœ¬ä¸­çš„ä½ç½®ã€‚</p></li></ol><p>MDN ä¸Šæ˜¯è¿™æ ·è§£é‡Šçš„ï¼š</p><blockquote><p>å¦‚æœèµ·å§‹èŠ‚ç‚¹ç±»å‹æ˜¯ Textã€Comment æˆ– CDATASection ä¹‹ä¸€ï¼Œé‚£ä¹ˆ startOffset æŒ‡çš„æ˜¯ä»èµ·å§‹èŠ‚ç‚¹ç®—èµ·å­—ç¬¦çš„åç§»é‡ã€‚å¯¹äºå…¶ä»– Node ç±»å‹èŠ‚ç‚¹ï¼ŒstartOffset æ˜¯æŒ‡ä»èµ·å§‹ç»“ç‚¹å¼€å§‹ç®—èµ·å­èŠ‚ç‚¹çš„åç§»é‡ã€‚</p></blockquote><p><img src="/blog/_assets/window-getselection-selection.0de5ed27.gif" alt="window-getSelection-selection"></p><h4 id="ä¿®æ”¹é€‰åŒº"><a class="header-anchor" href="#ä¿®æ”¹é€‰åŒº" aria-hidden="true">#</a> ä¿®æ”¹é€‰åŒº</h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection/modify" target="_blank" rel="noopener noreferrer">selection.modify</a>ï¼šå¯ä»¥ç”¨æ¥ä¿®æ”¹é€‰åŒºï¼Œé€šè¿‡æŒ‡å®š <code>left</code> æˆ– <code>rigth</code> æ¥å‘å·¦æˆ–å‘å³ä¿®æ”¹é€‰åŒºï¼ŒèŒƒå›´å¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ªå­—ç¬¦ã€å•è¯ã€æ®µè½ã€è¡Œç­‰ç­‰ã€‚</p><div class="language-js"><pre><code><span class="token comment">// å‘å·¦æ·»åŠ ä¸€ä¸ªå­—ç¬¦åˆ°é€‰åŒº</span>\nselection<span class="token operator">?.</span><span class="token function">modify</span><span class="token punctuation">(</span><span class="token string">&#39;extend&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;left&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;character&#39;</span><span class="token punctuation">)</span>\n<span class="token comment">// å‘å³æ·»åŠ ä¸€ä¸ªå•è¯åˆ°é€‰åŒº</span>\nselection<span class="token operator">?.</span><span class="token function">modify</span><span class="token punctuation">(</span><span class="token string">&#39;extend&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;right&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;word&#39;</span><span class="token punctuation">)</span>\n</code></pre></div><p><img src="/blog/_assets/window-getselection-move.9c152b6a.gif" alt="window-getSelection-move"></p><h4 id="è®¾ç½®å…‰æ ‡ä½ç½®"><a class="header-anchor" href="#è®¾ç½®å…‰æ ‡ä½ç½®" aria-hidden="true">#</a> è®¾ç½®å…‰æ ‡ä½ç½®</h4><p>å…‰æ ‡ä½ç½®çš„è®¾ç½®å¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•å®ç°ï¼š</p><ol><li>å•çº¯ä½¿ç”¨ range.setStartï¼Œå³ç»™å®šèµ·å§‹èŒƒå›´ï¼Œä¸ç»™ç»“æŸèŒƒå›´ï¼Œé‚£ä¹ˆæ­¤æ—¶å…‰æ ‡å°±ä¼šèšç„¦åœ¨ range.setStart è®¾ç½®çš„èŒƒå›´å‰ï¼›</li><li>ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection/collapse" target="_blank" rel="noopener noreferrer">selection.collapse</a>ï¼Œä¼ å…¥å…‰æ ‡éœ€è¦è½åœ¨çš„ç›®æ ‡èŠ‚ç‚¹ï¼Œä»¥åŠè½åœ¨èŠ‚ç‚¹çš„åç§»é‡ã€‚</li></ol><div class="language-js"><pre><code><span class="token comment">// 1. ä½¿ç”¨setStart/setStartå®ç°</span>\n<span class="token keyword">const</span> editor <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.editor&#39;</span><span class="token punctuation">)</span><span class="token operator">!</span>\n<span class="token keyword">const</span> range <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment">// range.setStart(editor.childNodes[1], 1)</span>\n<span class="token comment">// selection?.removeAllRanges()</span>\n<span class="token comment">// selection?.addRange(range)</span>\n<span class="token comment">// 2. ä½¿ç”¨selection.collapseå®ç°</span>\nselection<span class="token operator">?.</span><span class="token function">collapse</span><span class="token punctuation">(</span>editor<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>\n</code></pre></div><h5 id="ç§»åŠ¨å…‰æ ‡ä½ç½®"><a class="header-anchor" href="#ç§»åŠ¨å…‰æ ‡ä½ç½®" aria-hidden="true">#</a> ç§»åŠ¨å…‰æ ‡ä½ç½®</h5><p>å¦‚æœåªæ˜¯ç§»åŠ¨å½“å‰å·²æœ‰å…‰æ ‡çš„ä½ç½®ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢æåˆ°çš„ selection.modify ï¼Œåªéœ€å°†ç¬¬ä¸€ä¸ªå‚æ•° <code>extend</code> æ”¹ä¸º <code>move</code> å³å¯ã€‚</p><div class="language-js"><pre><code><span class="token comment">//å‘å·¦ç§»åŠ¨å…‰æ ‡</span>\nselection<span class="token operator">?.</span><span class="token function">modify</span><span class="token punctuation">(</span><span class="token string">&#39;move&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;left&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;character&#39;</span><span class="token punctuation">)</span>\n<span class="token comment">// å‘å³ç§»åŠ¨å…‰æ ‡</span>\nselection<span class="token operator">?.</span><span class="token function">modify</span><span class="token punctuation">(</span><span class="token string">&#39;move&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;right&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;word&#39;</span><span class="token punctuation">)</span>\n</code></pre></div><h5 id="å°†å…‰æ ‡èšç„¦åˆ°é€‰åŒºå‰å"><a class="header-anchor" href="#å°†å…‰æ ‡èšç„¦åˆ°é€‰åŒºå‰å" aria-hidden="true">#</a> å°†å…‰æ ‡èšç„¦åˆ°é€‰åŒºå‰å</h5><p>å¦‚æœå·²æœ‰é€‰åŒºçš„æƒ…å†µä¸‹ï¼Œè¿˜æœ‰å¯ä»¥é’ˆå¯¹å·²æœ‰é€‰åŒºè¿›è¡Œå…‰æ ‡ä½ç½®è®¾ç½®çš„æ–¹æ³•ï¼š</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Range/collapse" target="_blank" rel="noopener noreferrer">range.collapse</a> â€”â€” æ­¤æ–¹æ³•ä¼šå°†é€‰ä¸­èŒƒå›´å‘è¾¹ç•Œç‚¹ï¼ˆå‰/åï¼‰è¿›è¡ŒæŠ˜å ï¼Œä¼ å…¥ true æŠ˜å åˆ° Range å¼€å§‹çš„èŠ‚ç‚¹ï¼Œfalse æŠ˜å åˆ° Range ç»ˆç‚¹çš„èŠ‚ç‚¹ï¼› <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection/collapseToStart" target="_blank" rel="noopener noreferrer">selection.collapseToStart</a> â€”â€” æŠ˜å åˆ°é€‰åŒºèµ·ç‚¹ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection/collapseToEnd" target="_blank" rel="noopener noreferrer">selection.collapseToEnd</a> â€”â€” æŠ˜å åˆ°é€‰åŒºç»ˆç‚¹</p><div class="language-js"><pre><code><span class="token comment">// range?.collapse(false);</span>\n<span class="token comment">// 1. ä½¿ç”¨collapseToStart</span>\n<span class="token comment">// selection?.collapseToStart()</span>\n<span class="token comment">// 2. ä½¿ç”¨collapseToEnd</span>\nselection<span class="token operator">?.</span><span class="token function">collapseToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre></div><p><img src="/blog/_assets/window-getselection-extend.f23903b6.gif" alt="window-getSelection-extend"></p><h4 id="æ·»åŠ -æ›¿æ¢é€‰åŒºå†…å®¹"><a class="header-anchor" href="#æ·»åŠ -æ›¿æ¢é€‰åŒºå†…å®¹" aria-hidden="true">#</a> æ·»åŠ /æ›¿æ¢é€‰åŒºå†…å®¹</h4><p>å¾€å¯Œæ–‡æœ¬ä¸­æ’å…¥/æ›¿æ¢å†…å®¹ï¼Œåœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­åº”è¯¥åº”è¯¥ä¼šæœ‰æ‰€æ¥è§¦ï¼Œé‚£ä¹ˆä½ æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p><p>ä¸€ç§æ˜¯ä½¿ç”¨ document.insertHTML æ¥å®ç°ï¼Œæ¯”å¦‚å‰é¢æåˆ°çš„ @ åŠŸèƒ½ï¼Œæˆ‘ä¸€å¼€å§‹ä¹Ÿæ˜¯ä½¿ç”¨ document.insertHTML æ¥å®ç°ï¼Œä½†æ˜¯é‡åˆ°äº†é—®é¢˜ï¼Œç±»ä¼¼<a href="https://stackoverflow.com/questions/25941559/is-there-a-way-to-keep-execcommandinserthtml-from-removing-attributes-in-chr" target="_blank" rel="noopener noreferrer">è¿™ä¸ªé—®é¢˜</a>ï¼›çœ‹è¯„è®ºè¯´å¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Range/insertNode" target="_blank" rel="noopener noreferrer">range.insertNode</a> æ¥å®ç°ã€‚</p><p>å…·ä½“çš„å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>è·å–å½“å‰é€‰åŒºï¼Œæ²¡æœ‰é€‰åŒºæ²¡æ³•æ·»åŠ ï¼›</li><li>åˆ›å»ºéœ€è¦æ·»åŠ åˆ°é€‰åŒºä¸­çš„å…ƒç´  nodeï¼›</li><li>å¦‚æœéœ€è¦æ›¿æ¢é€‰åŒºå†…å®¹ï¼Œåˆ™éœ€è¦æ‰§è¡Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/deleteContents" target="_blank" rel="noopener noreferrer">range.deleteContents</a>ï¼›</li><li>é€šè¿‡ range.insertNode å°† node æ·»åŠ åˆ°é€‰åŒºï¼›</li><li>éœ€è¦æ‰§è¡Œ range.setStartAfter å°†å…‰æ ‡ç§»åŠ¨åˆ°æ’å…¥çš„å…ƒç´ ä¹‹åï¼ˆé»˜è®¤æ˜¯é€‰ä¸­æ’å…¥å…ƒç´ ï¼‰ï¼›</li><li>æ¢å¤é€‰åŒºä½ç½®ã€‚</li></ol><div class="language-js"><pre><code><span class="token keyword">const</span> editor <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.editor&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement\n<span class="token keyword">const</span> range <span class="token operator">=</span> selection<span class="token operator">?.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> mark <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;mark&#39;</span><span class="token punctuation">)</span>\nmark<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@xxx</span><span class="token template-punctuation string">`</span></span>\nmark<span class="token punctuation">.</span>contentEditable <span class="token operator">=</span> <span class="token string">&#39;false&#39;</span>\nmark<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&#39;comment-mentions-label&#39;</span>\nrange<span class="token operator">?.</span><span class="token function">deleteContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nrange<span class="token operator">?.</span><span class="token function">insertNode</span><span class="token punctuation">(</span>mark<span class="token punctuation">)</span>\nrange<span class="token operator">?.</span><span class="token function">setStartAfter</span><span class="token punctuation">(</span>mark<span class="token punctuation">)</span>\neditor<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre></div><p>åƒæˆ‘ä»¬è¿˜å¯èƒ½ä¼šé‡åˆ°åŠ ç²—ã€æ–œä½“ç­‰ç­‰ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/surroundContents" target="_blank" rel="noopener noreferrer">range.surroundContents</a> æ¥å®ç°ï¼ŒsurroundContents æ–¹æ³•å°† Range å¯¹è±¡çš„å†…å®¹ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œå¹¶å°†æ–°èŠ‚ç‚¹æ”¾åˆ°è¿™ä¸ªèŒƒå›´çš„èµ·å§‹å¤„ï¼Œç®€å•æ¥è¯´ï¼šå°±æ˜¯ä½¿ç”¨ä¼ å…¥çš„èŠ‚ç‚¹åŒ…è£¹å½“å‰é€‰å–ï¼Œä¾‹å¦‚å®ç°åŠ ç²—åŠŸèƒ½ï¼š</p><div class="language-js"><pre><code><span class="token keyword">const</span> strong <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;strong&#39;</span><span class="token punctuation">)</span>\nrange<span class="token operator">?.</span><span class="token function">surroundContents</span><span class="token punctuation">(</span>strong<span class="token punctuation">)</span>\n</code></pre></div><p><strong>æ³¨æ„ï¼šé€šè¿‡ range æ·»åŠ /æ›¿æ¢é€‰åŒºå†…å®¹åï¼Œæ— æ³•ä½¿ç”¨ Ctrl+Z æ’¤æ¶ˆ</strong></p><h3 id="å®ç°æœ€åˆçš„éœ€æ±‚ï¼šè®°å½•é€‰åŒºå¹¶æ¢å¤"><a class="header-anchor" href="#å®ç°æœ€åˆçš„éœ€æ±‚ï¼šè®°å½•é€‰åŒºå¹¶æ¢å¤" aria-hidden="true">#</a> å®ç°æœ€åˆçš„éœ€æ±‚ï¼šè®°å½•é€‰åŒºå¹¶æ¢å¤</h3><p>å¦‚æœäº†è§£äº†ä»¥ä¸ŠçŸ¥è¯†ï¼Œé‚£æ­¤æ—¶æˆ‘ä»¬è¦å®ç°æ¢å¤é€‰åŒºçš„æ–¹æ³•ï¼Œåªéœ€è¦<strong>åœ¨ç¼–è¾‘å™¨å¤±ç„¦å‰è®°å½•é€‰åŒºï¼Œåœ¨ç‚¹å‡»åŠŸèƒ½æŒ‰é’®å®Œæˆåæ¢å¤é€‰åŒº</strong>å³å¯ï¼Œå¦‚ä¸‹ï¼ˆä¸ºäº†æ–¹ä¾¿ï¼Œå°è£…æˆä¸€ä¸ª hooksï¼‰ï¼š</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Ref<span class="token punctuation">,</span> onBeforeMount<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">useRestoreSelection</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">inputRef</span><span class="token operator">:</span> Ref<span class="token operator">&lt;</span>HTMLDivElement <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> <span class="token literal-property property">saveRange</span><span class="token operator">:</span> Range <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">saveSelection</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> sel <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>sel<span class="token punctuation">.</span>getRangeAt <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">.</span>rangeCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      saveRange <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">const</span> <span class="token function-variable function">restoreSelection</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>saveRange<span class="token punctuation">)</span> <span class="token keyword">return</span>\n    <span class="token keyword">const</span> sel <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span>\n    sel<span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    sel<span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>saveRange<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> editorDOM <span class="token operator">=</span> inputRef<span class="token punctuation">.</span>value\n    editorDOM<span class="token operator">?.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;blur&#39;</span><span class="token punctuation">,</span> saveSelection<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token function">onBeforeMount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> editorDOM <span class="token operator">=</span> inputRef<span class="token punctuation">.</span>value\n    editorDOM<span class="token operator">?.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;blur&#39;</span><span class="token punctuation">,</span> saveSelection<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token keyword">return</span> <span class="token punctuation">{</span>\n    restoreSelection<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> useRestoreSelection\n</code></pre></div><p>å¯ä»¥å°†ä¸Šé¢çš„ <code>editorRef.value?.focus()</code> æ›¿æ¢ä¸º <code>saveSelection</code> æ–¹æ³•ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">item</span><span class="token operator">:</span> ToolType</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> commandId<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> item\n  <span class="token function">restoreSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span>commandId<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>å…¶å®å¾ˆæ—©ä¹‹å‰å°±æœ‰ç”¨åˆ°è¿™ä¸¤ä¸ª APIï¼Œä½†ä¸€ç›´è®¤ä¸ºç”¨å¤„ä¸å¤§ï¼Œæ‰€æœ‰æ²¡æœ‰æ·±å…¥ç ”ç©¶ï¼Œæ¯æ¬¡æœ‰éœ€è¦çš„æ—¶å€™å°±ç™¾åº¦æŸ¥ä¸€æŸ¥ï¼Œç°åœ¨ç»ˆäºè‚¯èŠ±æ—¶é—´æ¥ææ¸…æ¥šï¼Œä»¥åé‡åˆ°è¿™ç§é—®é¢˜ä¹Ÿå°±ä¸ä¼šæ„Ÿåˆ°æ£˜æ‰‹äº†ã€‚</p><p>å¸Œæœ›å¤§å®¶é‡åˆ°ä¸ä¼šçš„ä¸œè¥¿æ—¶ï¼Œé™ä¸‹å¿ƒæ¥èŠ±æ—¶é—´å»ç ”ç©¶é€å®ƒï¼Œè¿™æ ·å°±ä¸è‡³äºæ¯æ¬¡é‡åˆ°éƒ½å»ç™¾åº¦ä¸€éã€‚</p>',98)];e.render=function(a,t,e,p,r,c){return n(),s("div",null,o)};export{t as __pageData,e as default};
