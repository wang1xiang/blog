import{f as n,g as s,J as a}from"./common-03e46d7f.js";const t='{"title":"Electron Sqlite3æ•°æ®åº“æ–‡ä»¶å­˜å‚¨ä¼˜åŒ–æ–¹æ¡ˆ","frontmatter":{"date":"2024-02-10","title":"Electron Sqlite3æ•°æ®åº“æ–‡ä»¶å­˜å‚¨ä¼˜åŒ–æ–¹æ¡ˆ","tags":["electron"],"describe":"Electron Sqlite3æ•°æ®åº“æ–‡ä»¶å­˜å‚¨ä¼˜åŒ–æ–¹æ¡ˆ"},"headers":[{"level":2,"title":"å‰æ–¹æ¡ˆ","slug":"å‰æ–¹æ¡ˆ"},{"level":2,"title":"é—®é¢˜","slug":"é—®é¢˜"},{"level":2,"title":"åŸå› ","slug":"åŸå› "},{"level":2,"title":"ä¼˜åŒ–æ–¹","slug":"ä¼˜åŒ–æ–¹"}],"relativePath":"docs/electron/electron-sqlite3.md","lastUpdated":1743558905234.9429}';var p={};const o=[a('<h2 id="å‰æ–¹æ¡ˆ"><a class="header-anchor" href="#å‰æ–¹æ¡ˆ" aria-hidden="true">#</a> å‰æ–¹æ¡ˆ</h2><p>æ•°æ®åº“æ–‡ä»¶ã€sqlite3.dbã€‘å­˜äºä»£ç å±‚æ¬¡æ ¹ç›®å½•ä¸‹ï¼Œæ•°æ®åº“åˆå§‹åŒ–æ—¶é€šè¿‡ app.getAppPath()æŒ‡å®šæ ¹ç›®å½•ä¸‹çš„æ•°æ®æ–‡ä»¶</p><h2 id="é—®é¢˜"><a class="header-anchor" href="#é—®é¢˜" aria-hidden="true">#</a> é—®é¢˜</h2><p>ç ”å‘ä¸­ä½¿ç”¨ sqlite3 æ—¶ï¼Œsqlite3.db æ•°æ®åº“æ–‡ä»¶å†…å®¹ä¼šè¢«æ”¹å˜ï¼Œgit æäº¤æ—¶ä¹Ÿä¼šè¯†åˆ«åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¼šæäº¤åˆ° gitï¼Œå½“è¿™ä¸ªæ–‡ä»¶å‡ºç°é”™è¯¯æ—¶ï¼Œä¹‹åå‘å¸ƒçš„ç‰ˆæœ¬éƒ½ä¼šå½±å“åˆ°</p><h2 id="åŸå› "><a class="header-anchor" href="#åŸå› " aria-hidden="true">#</a> åŸå› </h2><p>è®¤è¯†ä¸è¶³ï¼Œsqlite3.db åº”è¯¥å‚¨å­˜äºç”¨æˆ·æœ¬åœ°ç›®å½•è€Œä¸æ˜¯ä»£ç å±‚æ¬¡ï¼Œæ¯ä¸ªç”¨æˆ·çš„ sqlite3.db åº”è¯¥éƒ½æ˜¯ç‹¬ç«‹çš„</p><h2 id="ä¼˜åŒ–æ–¹"><a class="header-anchor" href="#ä¼˜åŒ–æ–¹" aria-hidden="true">#</a> ä¼˜åŒ–æ–¹</h2><p>å‰æï¼šElectron æ˜¯ä¸€ä¸ªä½¿ç”¨ JavaScript, HTML å’Œ CSS æ„å»ºè·¨å¹³å°æ¡Œé¢åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚å®ƒå…è®¸å¼€å‘è€…ä½¿ç”¨ Web æŠ€æœ¯æ¥åˆ›å»ºåŸç”Ÿçš„æ¡Œé¢åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶èƒ½å¤Ÿè®¿é—®åº•å±‚æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p><p>æ–¹æ¡ˆï¼šé‡‡ç”¨ node çš„å†…ç½®çš„ fs æ¨¡å—ï¼Œåœ¨æ•°æ®åº“åˆå§‹åŒ–æ—¶åœ¨ç”¨æˆ·ç›®å½•ä¸‹åˆ›å»ºå¯¹åº”çš„æ•°æ®åº“æ–‡ä»¶ sqlite3.dbï¼Œå¹¶ä½¿ç”¨è¯¥æ–‡ä»¶åˆå§‹åŒ–æ•°æ®åº“</p><p>ä»£ç ï¼š</p><div class="language-js"><pre><code><span class="token comment">// fs æ–¹æ³•</span>\n<span class="token comment">/** æ–‡ä»¶æ˜¯å¦å­˜åœ¨ */</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fileIsExist</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">dir</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    fs<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> fs<span class="token punctuation">.</span>constants<span class="token punctuation">.</span><span class="token constant">F_OK</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token comment">/** åˆ›å»ºæ–‡ä»¶ */</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">writeLocalFile</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">dir</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> data<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><div class="language-js"><pre><code><span class="token comment">// sqlite æ–¹æ³•</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;electron&#39;</span>\n<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&#39;path&#39;</span>\n<span class="token comment">/** 1ã€ç”¨æˆ·æ•°æ®ç›®å½• */</span>\n<span class="token keyword">const</span> <span class="token constant">LOCAL_USER_DIR</span> <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token string">&#39;userData&#39;</span><span class="token punctuation">)</span>\n<span class="token comment">/** 2ã€éœ€è¦åˆ›å»ºçš„æ•°æ®åº“æ–‡ä»¶è·¯å¾„ */</span>\n<span class="token keyword">const</span> <span class="token literal-property property">db_path</span><span class="token operator">:</span> string <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token constant">LOCAL_USER_DIR</span><span class="token punctuation">,</span> <span class="token string">&#39;sqlite3.db&#39;</span><span class="token punctuation">)</span>\n<span class="token comment">/** 3ã€ åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä»¥åŠæ˜¯å¦éœ€è¦åˆ›å»ºæ–‡ä»¶ï¼Œæ–‡ä»¶å­˜åœ¨è§¦å‘sqlite3æ•°æ®åº“åˆå§‹åŒ–*/</span>\n<span class="token keyword">function</span> <span class="token function">connectDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">fileIsExist</span><span class="token punctuation">(</span>db_path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">isExist</span><span class="token operator">:</span>any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token function">info_logger</span><span class="token punctuation">(</span>db_path <span class="token operator">+</span> <span class="token string">&#39;ç›®æ ‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨&#39;</span> <span class="token operator">+</span> isExist<span class="token punctuation">)</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>isExist<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">onInitDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token function">writeLocalFile</span><span class="token punctuation">(</span>db_path<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">err</span><span class="token operator">:</span>any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">error_logger</span><span class="token punctuation">(</span>db_path <span class="token operator">+</span> <span class="token string">&#39;ç›®æ ‡æ–‡ä»¶å†™å…¥å¤±è´¥&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          <span class="token function">info_logger</span><span class="token punctuation">(</span>db_path <span class="token operator">+</span> <span class="token string">&#39;ç›®æ ‡æ–‡ä»¶å†™å…¥æˆåŠŸ&#39;</span><span class="token punctuation">)</span>\n          <span class="token function">onInitDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token comment">/** 4ã€sqlite3æ•°æ®åº“åˆå§‹åŒ– */</span>\n<span class="token keyword">function</span> <span class="token function">onInitDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">sqlite3<span class="token punctuation">.</span>Database</span><span class="token punctuation">(</span>db_path<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">err</span><span class="token operator">:</span>any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">error_logger</span><span class="token punctuation">(</span><span class="token string">&#39;ğŸ™…sqlite3è¿æ¥å¤±è´¥ï¼š&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token function">info_logger</span><span class="token punctuation">(</span><span class="token string">&#39;âœ…sqlite3è¿æ¥æˆåŠŸï¼&#39;</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div>',12)];p.render=function(a,t,p,e,c,l){return n(),s("div",null,o)};export{t as __pageData,p as default};
