import{f as n,g as s,J as a}from"./common-03e46d7f.js";const t='{"title":"ã€Œè®°å½•ç¯‡ã€æˆ‘æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥ä¸ºå…¬å¸æ­å»ºreacté¡¹ç›®è„šæ‰‹æ¶çš„","frontmatter":{"date":"2023-05-13","title":"ã€Œè®°å½•ç¯‡ã€æˆ‘æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥ä¸ºå…¬å¸æ­å»ºreacté¡¹ç›®è„šæ‰‹æ¶çš„","tags":["vite"],"describe":"é›†æˆReact-Routerã€Antdã€Redux-Toolkitå’ŒReact-Queryï¼Œå¹¶å°è£…ESLint+Prettier+Huskyçš„Reacté¡¹ç›®è„šæ‰‹æ¶ï¼Œå¿«æ¥è¯•è¯•å§ï¼"},"headers":[{"level":2,"title":"ğŸ”¥ è¿è¡Œæµç¨‹","slug":"ğŸ”¥-è¿è¡Œæµç¨‹"},{"level":2,"title":"ğŸ å®‰è£… & ä½¿ç”¨","slug":"ğŸ-å®‰è£…-ä½¿ç”¨"},{"level":2,"title":"èµ·å› ","slug":"èµ·å› "},{"level":2,"title":"é’ˆå¯¹ create-vite çš„ä¿®æ”¹","slug":"é’ˆå¯¹-create-vite-çš„ä¿®æ”¹"},{"level":3,"title":"åˆ é™¤ä¸éœ€è¦çš„æ¨¡å—","slug":"åˆ é™¤ä¸éœ€è¦çš„æ¨¡å—"},{"level":3,"title":"ä¿®æ”¹æ¨¡æ¿ vite.config.ts ä»£ç ","slug":"ä¿®æ”¹æ¨¡æ¿-vite-config-ts-ä»£ç "},{"level":3,"title":"ä½¿ç”¨ sass ä½œä¸º css é¢„å¤„ç†å™¨","slug":"ä½¿ç”¨-sass-ä½œä¸º-css-é¢„å¤„ç†å™¨"},{"level":3,"title":"å°† classnames å¼•å…¥é¡¹ç›®","slug":"å°†-classnames-å¼•å…¥é¡¹ç›®"},{"level":2,"title":"ç»Ÿä¸€ä»£ç  & git è§„èŒƒ","slug":"ç»Ÿä¸€ä»£ç -git-è§„èŒƒ"},{"level":3,"title":"ä½¿ç”¨ EditorConfig ç»Ÿä¸€ IDE ç¼–ç é£æ ¼","slug":"ä½¿ç”¨-editorconfig-ç»Ÿä¸€-ide-ç¼–ç é£æ ¼"},{"level":3,"title":"æ·»åŠ  eslint & prettier ç”¨äºä»£ç è§„èŒƒ","slug":"æ·»åŠ -eslint-prettier-ç”¨äºä»£ç è§„èŒƒ"},{"level":3,"title":"æ·»åŠ  pre-commit å’Œ commit-msg é’©å­","slug":"æ·»åŠ -pre-commit-å’Œ-commit-msg-é’©å­"},{"level":2,"title":"é›†æˆ ant design ä½œä¸º UI åº“","slug":"é›†æˆ-ant-design-ä½œä¸º-ui-åº“"},{"level":2,"title":"é›†æˆ react-router ä½œä¸ºè·¯ç”±","slug":"é›†æˆ-react-router-ä½œä¸ºè·¯ç”±"},{"level":3,"title":"react-router v6 è¯´æ˜","slug":"react-router-v6-è¯´æ˜"},{"level":3,"title":"react-router v6 ä½¿ç”¨æ•™ç¨‹","slug":"react-router-v6-ä½¿ç”¨æ•™ç¨‹"},{"level":2,"title":"é›†æˆ Redux toolkit ä½œä¸ºçŠ¶æ€ç®¡ç†","slug":"é›†æˆ-redux-toolkit-ä½œä¸ºçŠ¶æ€ç®¡ç†"},{"level":3,"title":"ä¸ºä»€ä¹ˆæ˜¯ Redux toolkit","slug":"ä¸ºä»€ä¹ˆæ˜¯-redux-toolkit"},{"level":3,"title":"Redux Toolkit ä½¿ç”¨æ•™ç¨‹","slug":"redux-toolkit-ä½¿ç”¨æ•™ç¨‹"},{"level":3,"title":"Redux Toolkit å¼‚æ­¥æ“ä½œ","slug":"redux-toolkit-å¼‚æ­¥æ“ä½œ"},{"level":2,"title":"é›†æˆ react-query ä½œä¸ºè¯·æ±‚åº“","slug":"é›†æˆ-react-query-ä½œä¸ºè¯·æ±‚åº“"},{"level":3,"title":"ä¸ºä»€ä¹ˆæ˜¯ react query","slug":"ä¸ºä»€ä¹ˆæ˜¯-react-query"},{"level":3,"title":"react query ä½¿ç”¨æ•™ç¨‹","slug":"react-query-ä½¿ç”¨æ•™ç¨‹"},{"level":2,"title":"å‘å¸ƒ npm","slug":"å‘å¸ƒ-npm"},{"level":2,"title":"å¦‚ä½•ä½¿ç”¨","slug":"å¦‚ä½•ä½¿ç”¨"},{"level":2,"title":"æ€»ç»“","slug":"æ€»ç»“"}],"relativePath":"docs/vite/vite-react-cli.md","lastUpdated":1743134641219.317}';var p={};const o=[a('<h1 id="create-vct"><a class="header-anchor" href="#create-vct" aria-hidden="true">#</a> <img src="/blog/_assets/create-vct.3c13469e.svg" alt="create-vct"> create-vct</h1><p>è¿™æ˜¯ä¸€ä¸ªç”¨äºåˆå§‹åŒ– vite + React ä¼ä¸šçº§é¡¹ç›®çš„è„šæ‰‹æ¶å·¥å…·ã€‚</p><h2 id="ğŸ”¥-è¿è¡Œæµç¨‹"><a class="header-anchor" href="#ğŸ”¥-è¿è¡Œæµç¨‹" aria-hidden="true">#</a> ğŸ”¥ è¿è¡Œæµç¨‹</h2><p><img src="/blog/_assets/create-vct-flow.31105c05.gif" alt="create-vct-flow.gif"></p><h2 id="ğŸ-å®‰è£…-ä½¿ç”¨"><a class="header-anchor" href="#ğŸ-å®‰è£…-ä½¿ç”¨" aria-hidden="true">#</a> ğŸ å®‰è£… &amp; ä½¿ç”¨</h2><div class="language-bash"><pre><code>npx create-vct\n\n<span class="token comment"># or</span>\n<span class="token function">npm</span> i create-vct -g\ncreate-vct\n</code></pre></div><h2 id="èµ·å› "><a class="header-anchor" href="#èµ·å› " aria-hidden="true">#</a> èµ·å› </h2><p>æˆ‘ä»¬å…¬å¸å‰ç«¯ç»Ÿä¸€ç”¨ vue3ï¼Œä½†æœ€è¿‘æœ‰ä¸ªç™½æ¿é¡¹ç›®<a href="https://juejin.cn/post/7232947178691444794" target="_blank" rel="noopener noreferrer">äº§å“ç»ç†ï¼šå®¢æˆ·æƒ³è¦ä¸ªç”»æ¿ï¼Œä½ ä»¬å‰ç«¯èƒ½ä¸èƒ½åšï¼Ÿ</a>ï¼Œåªæœ‰ react çš„æ¡†æ¶å¯ä»¥åšã€‚é¢†å¯¼è¯´è®©æˆ‘æ¥å¼„è¿™ä¸ªé¡¹ç›®ï¼Œé¡ºä¾¿å®Œäº†ä¹‹åæ­ä¸€ä¸ª react è„šæ‰‹æ¶å·¥å…·ç”¨äºä»¥åå¿«é€Ÿå¼€å‘ react åº”ç”¨ã€‚okï¼Œæ¥å—æŒ‘æˆ˜ ğŸ˜œã€‚</p><p>create-vct è„šæ‰‹æ¶å·¥å…·æ˜¯åœ¨ create-vite çš„åŸºç¡€ä¸Šä¿®æ”¹ï¼Œå°è£…äº† react ä¸­å¸¸ç”¨åˆ°çš„å„ç§åŒ…ï¼š<a href="https://reactrouter.com/en/mRin" target="_blank" rel="noopener noreferrer">react-router</a>ã€<a href="https://redux-toolkit.js.org/" target="_blank" rel="noopener noreferrer">redux-toolkit</a>ã€<a href="https://cangsdarm.github.io/react-query-web-i18n/react/" target="_blank" rel="noopener noreferrer">react-query</a>ã€<a href="https://ant.design/index-cn" target="_blank" rel="noopener noreferrer">antd</a> ç­‰ç­‰ï¼ŒåŒ…å« ts å’Œ js ç‰ˆæœ¬ï¼ŒåŒæ—¶ä¹Ÿå°è£…äº† eslint + prettier + husky + commitlint ç”¨äºå›¢é˜Ÿè§„èŒƒã€‚</p><p>ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä¸ªè¿‡ç¨‹ï¼Œç¯‡å¹…è¾ƒé•¿ï¼Œè¯·è€å¿ƒè§‚çœ‹ã€‚</p><h2 id="é’ˆå¯¹-create-vite-çš„ä¿®æ”¹"><a class="header-anchor" href="#é’ˆå¯¹-create-vite-çš„ä¿®æ”¹" aria-hidden="true">#</a> é’ˆå¯¹ create-vite çš„ä¿®æ”¹</h2><p><img src="/blog/_assets/create-vite-load.dec459a4.png" alt="create-vite-load.png"></p><p><strong>&quot;å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨&quot;</strong>ï¼Œå¼€å§‹ä¹‹å‰ï¼Œå¦‚æœä¸ç†Ÿæ‚‰ create-vite æºç çš„å°ä¼™ä¼´ï¼Œæ¬¢è¿é˜…è¯»è¿™ç¯‡æ–‡ç« <a href="https://juejin.cn/post/7217750296171118651" target="_blank" rel="noopener noreferrer">ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼šä½ è¿˜ä¸æ‡‚ create-vite åŸç†å—ï¼Ÿæ¥ä¸€èµ·åº·åº·</a>ï¼Œé¡ºä¾¿åŠ¨åŠ¨ä½ çš„å°æ‰‹æ‰‹ç‚¹ä¸ªèµ ğŸ‘ã€‚</p><h3 id="åˆ é™¤ä¸éœ€è¦çš„æ¨¡å—"><a class="header-anchor" href="#åˆ é™¤ä¸éœ€è¦çš„æ¨¡å—" aria-hidden="true">#</a> åˆ é™¤ä¸éœ€è¦çš„æ¨¡å—</h3><p>å› ä¸ºæˆ‘ä»¬åªéœ€è¦ react çš„æ¨¡æ¿ï¼Œæ‰€ä»¥æŠŠå…¶ä»–ä¸éœ€è¦çš„ä¸€å¹¶åˆ é™¤æ‰ï¼Œæœ€ååªç•™ä¸‹è¿™äº›æ–‡ä»¶ã€‚ <img src="/blog/_assets/create-vite-delete.ea9e65d5.png" alt="create-vite-delete.png"></p><h3 id="ä¿®æ”¹æ¨¡æ¿-vite-config-ts-ä»£ç "><a class="header-anchor" href="#ä¿®æ”¹æ¨¡æ¿-vite-config-ts-ä»£ç " aria-hidden="true">#</a> ä¿®æ”¹æ¨¡æ¿ vite.config.ts ä»£ç </h3><ol><li><p>é…ç½® alias æ·»åŠ åˆ«åè®¾ç½®</p></li><li><p>é…ç½® server ä»£ç†æœåŠ¡å™¨</p><div class="language-ts"><pre><code> <span class="token comment">// vite.config.ts</span>\n <span class="token operator">...</span>\n <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n   resolve<span class="token operator">:</span> <span class="token punctuation">{</span>\n     alias<span class="token operator">:</span> <span class="token punctuation">{</span>\n       <span class="token string-property property">&#39;@&#39;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// src è·¯å¾„</span>\n     <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   server<span class="token operator">:</span> <span class="token punctuation">{</span>\n     port<span class="token operator">:</span> <span class="token number">5173</span><span class="token punctuation">,</span> <span class="token comment">// å¼€å‘ç¯å¢ƒå¯åŠ¨çš„ç«¯å£</span>\n     proxy<span class="token operator">:</span> <span class="token punctuation">{</span>\n       <span class="token string-property property">&#39;/api&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n         <span class="token comment">// å½“é‡åˆ° /api è·¯å¾„æ—¶ï¼Œå°†å…¶è½¬æ¢æˆ target çš„å€¼</span>\n         target<span class="token operator">:</span> <span class="token string">&#39;http://xx.xx.xx.xx:8080/api&#39;</span><span class="token punctuation">,</span>\n         changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">rewrite</span><span class="token operator">:</span> <span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\\/api</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å°† /api é‡å†™ä¸ºç©º</span>\n       <span class="token punctuation">}</span><span class="token punctuation">,</span>\n     <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n <span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div></li><li><p>è·¯å¾„åˆ«ååŒæ—¶éœ€è¦é…ç½® tsconfig.jsonï¼Œä¸ç„¶ç›´æ¥ä½¿ç”¨ ts ä¼šæŠ¥é”™</p><div class="language-json"><pre><code><span class="token comment">// tsconfig.json</span>\n<span class="token punctuation">{</span>\n  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;paths&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">&quot;@/*&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/*&quot;</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div></li></ol><h3 id="ä½¿ç”¨-sass-ä½œä¸º-css-é¢„å¤„ç†å™¨"><a class="header-anchor" href="#ä½¿ç”¨-sass-ä½œä¸º-css-é¢„å¤„ç†å™¨" aria-hidden="true">#</a> ä½¿ç”¨ sass ä½œä¸º css é¢„å¤„ç†å™¨</h3><p>å…¬å¸é¡¹ç›®éƒ½æ˜¯ä½¿ç”¨ sassï¼Œæ‰€ä»¥è¿™ä¸ªè„šæ‰‹æ¶è‡ªç„¶ä½¿ç”¨ sass æ¥å¤„ç† cssã€‚</p><ol><li><p>åœ¨ package.json ä¸­ä¾èµ–ä¸­æ·»åŠ <code>&quot;sass&quot;: &quot;^1.62.1&quot;</code>ï¼›</p></li><li><p>å°†.css åç¼€æ–‡ä»¶ä¿®æ”¹ä¸º.scss åç¼€æ–‡ä»¶ï¼›</p></li><li><p>åˆ›å»º src/styles/variables.scssï¼Œè®¾ç½®å…¨å±€ sass å˜é‡ï¼›</p></li><li><p>åœ¨ vite.config.js ä¸­é…ç½®å…¨å±€ sass å˜é‡ï¼š</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token operator">...</span>\n  <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token literal-property property">preprocessorOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token literal-property property">scss</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token literal-property property">additionalData</span><span class="token operator">:</span> <span class="token string">&#39;@import &quot;@/styles/variables.scss&quot;;&#39;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span>\n  <span class="token operator">...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div><p><strong>æ³¨æ„ï¼švite å¯¹.sass å·²ç»æä¾›äº†å†…ç½®æ”¯æŒï¼Œæ‰€ä»¥ä¸å†éœ€è¦å®‰è£… loader äº†ï¼Œ<a href="https://cn.vitejs.dev/guide/features.html#css-pre-processors" target="_blank" rel="noopener noreferrer">å®˜æ–¹è§£é‡Š</a></strong></p></li></ol><h3 id="å°†-classnames-å¼•å…¥é¡¹ç›®"><a class="header-anchor" href="#å°†-classnames-å¼•å…¥é¡¹ç›®" aria-hidden="true">#</a> å°† classnames å¼•å…¥é¡¹ç›®</h3><p>ä¸ªäººæ„Ÿè§‰ CSS Modules æ¯” CSS In JS ç”¨èµ·æ¥æ›´èˆ’æœï¼Œæ‰€ä»¥è¯¥è„šæ‰‹æ¶ä½¿ç”¨ CSS Modules çš„æ–¹å¼æ¥å¤„ç† cssï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨ CSS In JS çš„æ–¹å¼å¤„ç†ï¼Œé¡¹ç›®æ¨¡æ¿æ²¡æœ‰å¤ªå¤š css ä»£ç ï¼Œä¸ä¼šå½±å“åˆ°ä½ çš„é€‰æ‹©ã€‚</p><p>åœ¨ package.json ä¸­ä¾èµ–ä¸­æ·»åŠ <code>&quot;classnames&quot;: &quot;^2.3.2&quot;</code>å³å¯ã€‚</p><p>ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼š</p><div class="language-js"><pre><code><span class="token keyword">import</span> classNames <span class="token keyword">from</span> <span class="token string">&#39;classnames/bind&#39;</span>\n<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">&#39;./index.module.scss&#39;</span>\n<span class="token keyword">const</span> cx <span class="token operator">=</span> <span class="token function">classNames</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">cx</span><span class="token punctuation">(</span><span class="token string">&#39;btn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;btn-primary&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="ç»Ÿä¸€ä»£ç -git-è§„èŒƒ"><a class="header-anchor" href="#ç»Ÿä¸€ä»£ç -git-è§„èŒƒ" aria-hidden="true">#</a> ç»Ÿä¸€ä»£ç  &amp; git è§„èŒƒ</h2><p><img src="/blog/_assets/eslint-logo.7cebb5dd.png" alt="eslint-logo.png"></p><h3 id="ä½¿ç”¨-editorconfig-ç»Ÿä¸€-ide-ç¼–ç é£æ ¼"><a class="header-anchor" href="#ä½¿ç”¨-editorconfig-ç»Ÿä¸€-ide-ç¼–ç é£æ ¼" aria-hidden="true">#</a> ä½¿ç”¨ EditorConfig ç»Ÿä¸€ IDE ç¼–ç é£æ ¼</h3><p>.editorconfig æ–‡ä»¶åˆ›å»ºåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼š</p><div class="language-bash"><pre><code><span class="token punctuation">[</span>*<span class="token punctuation">]</span>\nindent_style <span class="token operator">=</span> space\nindent_size <span class="token operator">=</span> <span class="token number">2</span>\nend_of_line <span class="token operator">=</span> lf\ncharset <span class="token operator">=</span> utf-8\ntrim_trailing_whitespace <span class="token operator">=</span> <span class="token boolean">false</span>\ninsert_final_newline <span class="token operator">=</span> <span class="token boolean">false</span>\n</code></pre></div><h3 id="æ·»åŠ -eslint-prettier-ç”¨äºä»£ç è§„èŒƒ"><a class="header-anchor" href="#æ·»åŠ -eslint-prettier-ç”¨äºä»£ç è§„èŒƒ" aria-hidden="true">#</a> æ·»åŠ  eslint &amp; prettier ç”¨äºä»£ç è§„èŒƒ</h3><p>eslint å’Œ prettier çš„å®‰è£…å‚è€ƒçš„æ˜¯<a href="https://github.com/tzsk/vite-pretty-lint" target="_blank" rel="noopener noreferrer">vite-pretty-lint</a>ï¼Œå°†é¡¹ç›®æºç å…‹éš†åˆ°æœ¬åœ°ï¼Œåªéœ€è¦åˆ›å»ºæ–‡ä»¶çš„é‚£éƒ¨åˆ†ä»£ç ï¼Œå…¶ä½™çš„å¯åˆ é™¤ã€‚</p><h3 id="æ·»åŠ -pre-commit-å’Œ-commit-msg-é’©å­"><a class="header-anchor" href="#æ·»åŠ -pre-commit-å’Œ-commit-msg-é’©å­" aria-hidden="true">#</a> æ·»åŠ  pre-commit å’Œ commit-msg é’©å­</h3><p>æ·»åŠ  githooksï¼Œåœ¨æäº¤å‰å¯¹ä»£ç è¿›è¡Œæ ¡éªŒå’Œæ ¼å¼åŒ–å¤„ç†ï¼Œå¹¶è§„èŒƒæäº¤ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« ï¼š<a href="https://juejin.cn/post/7215454235046445112" target="_blank" rel="noopener noreferrer">vue3 é¡¹ç›®æ·»åŠ  husky+lint-staged é…ç½®</a>ã€‚</p><p>æˆ‘ä»¬çœ‹çœ‹åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­é…ç½® git hooks éƒ½éœ€è¦å“ªäº›æ­¥éª¤ã€‚</p><ol><li><p>æ·»åŠ  husky å’Œ lint-staged ä¾èµ–</p><div class="language-bash"><pre><code><span class="token function">yarn</span> <span class="token function">add</span> lint-staged husky\n</code></pre></div></li><li><p>åˆå§‹åŒ– huskyï¼Œç”Ÿæˆ.husky æ–‡ä»¶</p><div class="language-bash"><pre><code><span class="token function">yarn</span> husky <span class="token function">install</span>\n</code></pre></div></li><li><p>åœ¨ package.json çš„ scripts ä¸­æ·»åŠ  prepare ä¸ªé’©å­</p><div class="language-json"><pre><code> <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n   <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">,</span>\n   <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsc &amp;&amp; vite build&quot;</span><span class="token punctuation">,</span>\n   <span class="token property">&quot;preview&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite preview&quot;</span><span class="token punctuation">,</span>\n   <span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --ext .ts --ext .tsx src --fix&quot;</span><span class="token punctuation">,</span>\n   <span class="token property">&quot;prepare&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npx husky install&quot;</span>\n <span class="token punctuation">}</span><span class="token punctuation">,</span>\n</code></pre></div></li><li><p>åœ¨ package.json ä¸­é…ç½® lint-staged</p><div class="language-json"><pre><code> <span class="token property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n   <span class="token property">&quot;src/**/*.{js,jsx,ts,tsx,json,md}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n     <span class="token string">&quot;eslint --fix --max-warnings=0&quot;</span><span class="token punctuation">,</span>\n     <span class="token string">&quot;prettier --write&quot;</span>\n   <span class="token punctuation">]</span><span class="token punctuation">,</span>\n   <span class="token property">&quot;src/**/*.{scss,less,css}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n     <span class="token string">&quot;prettier --write&quot;</span>\n   <span class="token punctuation">]</span><span class="token punctuation">,</span>\n <span class="token punctuation">}</span>\n</code></pre></div></li><li><p>æ·»åŠ  pre-commit é’©å­ï¼Œä¼šåœ¨.husky ç›®å½•ä¸‹ç”Ÿæˆ pre-commit æ–‡ä»¶</p><div class="language-bash"><pre><code>npx husky <span class="token function">add</span> .husky/pre-commit <span class="token string">&quot;npx lint-staged&quot;</span>\n</code></pre></div><p>è¿™ä¸€æ­¥å®Œæˆåï¼Œåœ¨æäº¤ä»£ç çš„æ—¶å€™å°±ä¼šæœ‰å¯¹æš‚å­˜åŒºçš„ä»£ç åš ESLint ä»£ç æ ¡éªŒå’Œ Prettier æ ¼å¼åŒ–å¤„ç†ã€‚</p></li><li><p>æ¥ç€æ˜¯ commitlint è§„èŒƒæäº¤ä¿¡æ¯ï¼Œå®‰è£…ä¾èµ–</p><div class="language-bash"><pre><code><span class="token function">yarn</span> <span class="token function">add</span> @commitlint/cli @commitlint/config-conventional -D\n</code></pre></div></li><li><p>åˆ›å»º commitlint.config.js é…ç½®æ–‡ä»¶</p><div class="language-js"><pre><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@commitlint/config-conventional&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre></div></li><li><p>ç”Ÿæˆ pre-commit hook</p><div class="language-bash"><pre><code>npx husky <span class="token function">add</span> .husky/commit-msg <span class="token string">&#39;npx commitlint --edit&#39;</span>\n</code></pre></div></li><li><p>åˆ°è¿™é‡Œï¼Œhusky + lint-staged + commitlint éƒ½é…ç½®å®Œæˆäº†ã€‚</p><p><img src="/blog/_assets/husky-error.be7e10b3.png" alt="husky-error.png"></p></li></ol><p>è¿™ä¸€æ­¥å®Œæˆåï¼Œæˆ‘ä»¬åŒæ—¶é…ç½®äº†ä»£ç è§„èŒƒå’Œ git è§„èŒƒï¼Œæ·»åŠ äº† huskyï¼Œæ‰€ä»¥éœ€è¦åœ¨é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œé¦–å…ˆ<strong>æ‰§è¡Œä¸€ä¸‹ git init åˆå§‹åŒ– git ä»“åº“ï¼Œç„¶å husky æ‰èƒ½æ­£å¸¸è¿è¡Œ</strong>ï¼Œäºæ˜¯å°±æŠŠæç¤ºä¿¡æ¯å¤šåŠ äº†ä¸€é¡¹ ğŸ¤”ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/blog/_assets/create-vct-init.a6fdd41c.png" alt="create-vct-init.png"></p><p>åŸºäºä»¥ä¸Šï¼Œæˆ‘ä»¬ä¿®æ”¹ create-vite çš„ä»£ç ï¼Œæ·»åŠ å¦‚ä¸‹ï¼š</p><div class="language-js"><pre><code><span class="token keyword">if</span> <span class="token punctuation">(</span>isEslint<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> eslintTemplate <span class="token operator">=</span> <span class="token string">&#39;../eslint-templates&#39;</span>\n  <span class="token keyword">const</span> eslintFile <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">,</span> <span class="token string">&#39;.eslintrc.json&#39;</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> prettierFile <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">,</span> <span class="token string">&#39;.prettierrc.json&#39;</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> eslintIgnoreFile <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">,</span> <span class="token string">&#39;.eslintignore&#39;</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> packages<span class="token punctuation">,</span> eslintOverrides <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span>\n    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>eslintTemplate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>template<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.js</span><span class="token template-punctuation string">`</span></span>\n  <span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> packageList <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>commonPackages<span class="token punctuation">,</span> <span class="token operator">...</span>packages <span class="token punctuation">}</span>\n  <span class="token keyword">const</span> eslintConfigOverrides <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>eslintConfig<span class="token punctuation">.</span>overrides<span class="token punctuation">,</span> <span class="token operator">...</span>eslintOverrides<span class="token punctuation">]</span>\n  <span class="token keyword">const</span> eslint <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>eslintConfig<span class="token punctuation">,</span> <span class="token literal-property property">overrides</span><span class="token operator">:</span> eslintConfigOverrides <span class="token punctuation">}</span>\n\n  <span class="token keyword">const</span> viteConfigFiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;vite.config.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;vite.config.ts&#39;</span><span class="token punctuation">]</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>viteFile<span class="token punctuation">]</span> <span class="token operator">=</span> viteConfigFiles\n    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> viteConfig <span class="token operator">=</span> <span class="token function">viteEslint</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>viteFile<span class="token punctuation">,</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>eslintFile<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>eslint<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>prettierFile<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>prettierConfig<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>eslintIgnoreFile<span class="token punctuation">,</span> eslintIgnore<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;\\n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>viteFile<span class="token punctuation">,</span> viteConfig<span class="token punctuation">)</span>\n  <span class="token keyword">const</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>eslintTemplate<span class="token punctuation">)</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> file <span class="token keyword">of</span> files<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>f<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;react&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">write</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> eslintTemplate<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  pkg<span class="token punctuation">.</span>devDependencies <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>pkg<span class="token punctuation">.</span>devDependencies<span class="token punctuation">,</span> <span class="token operator">...</span>packageList <span class="token punctuation">}</span>\n  pkg<span class="token punctuation">.</span>scripts <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>pkg<span class="token punctuation">.</span>scripts<span class="token punctuation">,</span> <span class="token operator">...</span>packageScripts <span class="token punctuation">}</span>\n  pkg<span class="token punctuation">[</span><span class="token string">&#39;lint-staged&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> packageMore\n\n  <span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;package.json&#39;</span><span class="token punctuation">,</span> templateDir<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>pkg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;\\n&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>è¿™ä¸€æ­¥ä¼šå°†<code>.husky</code>ã€<code>.editorconfig</code>ã€<code>commitlint.config.js</code>ã€<code>.eslintrc.json</code>ã€<code>.prettierrc.json</code>å’Œ<code>.eslintignore</code>é…ç½®æ·»åŠ åˆ°æ‰€åˆ›å»ºçš„é¡¹ç›®ä¸­ï¼Œå¹¶ä¿®æ”¹ package.json æ–‡ä»¶ï¼Œæ·»åŠ  ESLint çš„ä¾èµ–é¡¹ã€‚</p><h2 id="é›†æˆ-ant-design-ä½œä¸º-ui-åº“"><a class="header-anchor" href="#é›†æˆ-ant-design-ä½œä¸º-ui-åº“" aria-hidden="true">#</a> é›†æˆ ant design ä½œä¸º UI åº“</h2><p><img src="/blog/_assets/antd-logo.d12a9b34.png" alt="antd-logo.png"></p><p>æˆ‘ä»¬å…ˆæ¥æ¢³ç†ä¸‹ï¼Œå¦‚æœå¾€é¡¹ç›®ä¸­æ·»åŠ  Antd éœ€è¦åšå“ªäº›äº‹ï¼š</p><ol><li><p>æ·»åŠ  Antd ä¾èµ–ï¼›</p><p>ant-design@v5 ç‰ˆæœ¬æ”¯æŒ tree-shakingï¼Œå°±ä¸ç”¨é…ç½®æŒ‰éœ€åŠ è½½äº†ã€‚é‚£ä¹ˆå°±å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ package.json çš„<code>dependencies</code>å­—æ®µä¸­æ·»åŠ  Antd çš„åº“ã€‚</p></li><li><p>å…¨å±€å¼•å…¥ reset.css æ–‡ä»¶ï¼›</p></li><li><p>è®¾ç½® ConfigProvider å…¨å±€åŒ–é…ç½®ï¼›</p><div class="language-jsx"><pre><code><span class="token keyword">import</span> <span class="token string">&#39;antd/dist/reset.css&#39;</span>\n<span class="token keyword">import</span> zhCN <span class="token keyword">from</span> <span class="token string">&#39;antd/locale/zh_CN&#39;</span>\n<span class="token keyword">import</span> dayjs <span class="token keyword">from</span> <span class="token string">&#39;dayjs&#39;</span>\n<span class="token keyword">import</span> <span class="token string">&#39;dayjs/locale/zh-cn&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span>\n\ndayjs<span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">&#39;zh-cn&#39;</span><span class="token punctuation">)</span>\n\nReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">React.StrictMode</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigProvider</span></span> <span class="token attr-name">locale</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>zhCN<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ConfigProvider</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">React.StrictMode</span></span><span class="token punctuation">&gt;</span></span>\n<span class="token punctuation">)</span>\n</code></pre></div></li><li><p>ä¿®æ”¹ App ç»„ä»¶ï¼Œæ·»åŠ ä¸€ä¸ª antd çš„ç»„ä»¶ï¼Œè¿™æ ·å¯åŠ¨é¡¹ç›®å°±å¯ä»¥çœ‹åˆ° Antd çš„ç»„ä»¶ä½¿ç”¨æ–¹æ³•ã€‚</p></li></ol><p>åŸºäºä»¥ä¸Šçš„æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥ä»¿ç…§ ESLint é‚£å—çš„ä»£ç æ¥ä¿®æ”¹ï¼Œæœ€ç»ˆå®ç°å¦‚ä¸‹ï¼š</p><div class="language-js"><pre><code><span class="token comment">// antdé…ç½®</span>\n<span class="token keyword">const</span> fileSuffix <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&#39;-ts&#39;</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&#39;.tsx&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;.jsx&#39;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>isAntd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> AppComponent <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/src/App</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fileSuffix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> MainComponent <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/src/main</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fileSuffix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n  <span class="token comment">// @ts-ignore</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> packages<span class="token punctuation">,</span> App<span class="token punctuation">,</span> Main <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;../antd-templates/index.js&#39;</span><span class="token punctuation">)</span>\n  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>AppComponent<span class="token punctuation">,</span> App<span class="token punctuation">)</span>\n  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>MainComponent<span class="token punctuation">,</span> Main<span class="token punctuation">)</span>\n\n  pkg<span class="token punctuation">.</span>dependencies <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>pkg<span class="token punctuation">.</span>dependencies<span class="token punctuation">,</span> <span class="token operator">...</span>packages <span class="token punctuation">}</span>\n  <span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;package.json&#39;</span><span class="token punctuation">,</span> templateDir<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>pkg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;\\n&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="é›†æˆ-react-router-ä½œä¸ºè·¯ç”±"><a class="header-anchor" href="#é›†æˆ-react-router-ä½œä¸ºè·¯ç”±" aria-hidden="true">#</a> é›†æˆ react-router ä½œä¸ºè·¯ç”±</h2><p><img src="/blog/_assets/react-router-logo.6efcd422.png" alt="react-router-logo"></p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<a href="https://reactrouter.com/zh/main" target="_blank" rel="noopener noreferrer">react-router@v6</a>ç‰ˆæœ¬ï¼Œv6 ç‰ˆæœ¬ä¹‹å‰å¦‚æœä½¿ç”¨ typescript æ—¶ï¼Œéœ€è¦åŒæ—¶å®‰è£…<code>@types/react-router</code>ã€<code>@types/react-router-dom</code>ã€<code>react-router</code>å’Œ<code>react-router-dom</code>ã€‚</p><blockquote><p>react-router å’Œ react-router-dom çš„å…³ç³»ç±»ä¼¼äº react å’Œ react-domã€‚dom åŠæµè§ˆå™¨ç¯å¢ƒï¼Œreact-router-dom é€šè¿‡æ·»åŠ ç”¨äº DOM çš„ç»„ä»¶ï¼Œå¯ä»¥è®© react-router è¿è¡Œåœ¨æµè§ˆå™¨ç¯å¢ƒï¼ŒåŒæ—¶è¿˜æœ‰ react-router-nativeï¼Œç”¨äº native ç¯å¢ƒã€‚</p></blockquote><p>ä½¿ç”¨ v6 åä¸éœ€è¦å†å¼•å…¥é¢å¤–çš„ç±»å‹ï¼Œåªéœ€è¦å®‰è£…<code>react-router</code>å’Œ<code>react-router-dom</code>å³å¯ã€‚</p><h3 id="react-router-v6-è¯´æ˜"><a class="header-anchor" href="#react-router-v6-è¯´æ˜" aria-hidden="true">#</a> react-router v6 è¯´æ˜</h3><ul><li><code>&lt;Routes /&gt;</code>: æ–°å¢ç»„ä»¶ï¼Œç§»é™¤ v5 çš„<code>&lt;Switch /&gt;</code>ç»„ä»¶ï¼Œç”¨<code>&lt;Routes /&gt;</code>ç»„ä»¶ä»£æ›¿ï¼Œç”¨æ³•ç›¸åŒï¼›</li><li><code>&lt;Router /&gt;</code>: åŸºç¡€è·¯ç”±ç»„ä»¶ï¼Œv5 çš„ component={Home}æ”¹å†™ä¸º element={Home}ï¼›</li><li><code>&lt;Link /&gt;</code>: å¯¼èˆªç»„ä»¶ï¼›</li><li><code>&lt;Outlet /&gt;</code>: æ–°å¢ç»„ä»¶ï¼Œè‡ªé€‚åº”æ¸²æŸ“ç»„ä»¶ï¼›</li><li>useParams: æ–°å¢ Hookï¼Œè·å–å½“å‰è·¯ç”±æºå¸¦å‚æ•°ï¼›</li><li>useNavigate: æ–°å¢ Hookï¼Œç±»ä¼¼ v5 çš„ useHistoryï¼Œè·å–å½“å‰è·¯ç”±ï¼›</li><li>useOutlet: æ–°å¢ Hookï¼Œè·å–æ ¹æ®è·¯ç”±ç”Ÿæˆçš„ elementï¼›</li><li>useLocation: è·å–å½“å‰ location å¯¹è±¡ï¼›</li><li>useRoutes: åŒ<code>&lt;Routes&gt;</code>ç»„ä»¶ï¼Œåœ¨ js ä¸­ä½¿ç”¨ï¼›</li><li>useSearchParams: è·å– URL ä¸­ search å‚æ•°ã€‚</li></ul><h3 id="react-router-v6-ä½¿ç”¨æ•™ç¨‹"><a class="header-anchor" href="#react-router-v6-ä½¿ç”¨æ•™ç¨‹" aria-hidden="true">#</a> react-router v6 ä½¿ç”¨æ•™ç¨‹</h3><p>åŒ Antdï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹å°† react-router æ·»åŠ åˆ°é¡¹ç›®ä¸­çš„æ­¥éª¤ã€‚</p><ol><li><p>æ·»åŠ  react-router å’Œ react-router-dom ä¾èµ–ï¼›</p><div class="language-bash"><pre><code><span class="token function">yarn</span> <span class="token function">add</span> react-router-dom react-router\n</code></pre></div></li><li><p>æ·»åŠ  src/routes/routerConfig.ts æ–‡ä»¶ï¼Œé…ç½®è·¯ç”±è¡¨ï¼›</p><div class="language-js"><pre><code><span class="token keyword">import</span> ErrorPage <span class="token keyword">from</span> <span class="token string">&#39;@/pages/ErrorPage&#39;</span>\n<span class="token keyword">import</span> AppLayout <span class="token keyword">from</span> <span class="token string">&#39;@/layout/AppLayout&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> lazy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> MetaMenu<span class="token punctuation">,</span> AuthRouteObject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./interface&#39;</span>\n\n<span class="token comment">// å¿«é€Ÿå¯¼å…¥å·¥å…·å‡½æ•°</span>\n<span class="token keyword">const</span> <span class="token function-variable function">lazyLoad</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">moduleName</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>\n  <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@/pages/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.tsx</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> Home <span class="token operator">=</span> <span class="token function">lazyLoad</span><span class="token punctuation">(</span><span class="token string">&#39;Home&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> ReduxToolkitDemo <span class="token operator">=</span> <span class="token function">lazyLoad</span><span class="token punctuation">(</span><span class="token string">&#39;ReduxToolkitDemo&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> ReactQueryDemo <span class="token operator">=</span> <span class="token function">lazyLoad</span><span class="token punctuation">(</span><span class="token string">&#39;ReactQueryDemo&#39;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> <span class="token literal-property property">routers</span><span class="token operator">:</span> AuthRouteObject<span class="token operator">&lt;</span>MetaMenu<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>\n  <span class="token punctuation">{</span>\n    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span>\n    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>AppLayout <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>\n    <span class="token literal-property property">errorElement</span><span class="token operator">:</span> <span class="token operator">&lt;</span>ErrorPage <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>\n    <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span>\n        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>Home <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>\n        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;Home&#39;</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;toolkit&#39;</span><span class="token punctuation">,</span>\n        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>ReduxToolkitDemo <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>\n        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;React Toolkit&#39;</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;query&#39;</span><span class="token punctuation">,</span>\n        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>ReactQueryDemo <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>\n        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;React Query&#39;</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> routers\n</code></pre></div></li><li><p>åˆ›å»º src/layout æ–‡ä»¶å¤¹ï¼Œæ·»åŠ  AppLayout ç»„ä»¶ï¼›</p></li><li><p>åˆ›å»º src/pages æ–‡ä»¶å¤¹ï¼Œæ·»åŠ  Home å’Œ ReactQueryDemo ç»„ä»¶ï¼›</p></li><li><p>é€šè¿‡ <a href="https://reactrouter.com/en/main/hooks/use-routes" target="_blank" rel="noopener noreferrer">useRoutes</a> é’©å­å°†ä¸Šé¢çš„è·¯ç”±è¡¨ä¸€ä¸€æ˜ å°„ä¸ºè·¯ç”±å¯¹è±¡</p><p>useRoutes ä¹Ÿå°±æ˜¯<code>&lt;Routes /&gt;</code>ç»„ä»¶çš„ js å®ç°ï¼Œåœ¨è·¯ç”±è·³è½¬æ—¶éœ€è¦å¢åŠ  loading è½¬åœºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>&lt;Suspense /&gt;</code>ç»„ä»¶ä¼ å…¥ä¸€ä¸ª loading ç»„ä»¶æ¥å®ç°ã€‚</p><blockquote><p>æ­¤å¤„çš„ Loading ç»„ä»¶å¯æ ¹æ®é¡¹ç›®éœ€æ±‚æ¥ä¿®æ”¹è½¬åœºåŠ¨ç”»</p></blockquote><div class="language-tsx"><pre><code><span class="token keyword">import</span> <span class="token string">&#39;./App.scss&#39;</span>\n<span class="token keyword">import</span> routers <span class="token keyword">from</span> <span class="token string">&#39;./routes/routerConfig&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useRoutes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-router-dom&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Suspense <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Spin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span>\n\n<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> elements <span class="token operator">=</span> <span class="token function">useRoutes</span><span class="token punctuation">(</span>routers<span class="token punctuation">)</span>\n  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Spin</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>elements<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Suspense</span></span><span class="token punctuation">&gt;</span></span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> App\n</code></pre></div></li><li><p>åœ¨ main.tsx ä¸­é…ç½®<code>&lt;BrowserRouter /&gt;</code>åŒ…è£¹ App ç»„ä»¶</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-router-dom&#39;</span>\n\nReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">React.StrictMode</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">React.StrictMode</span></span><span class="token punctuation">&gt;</span></span>\n<span class="token punctuation">)</span>\n</code></pre></div></li></ol><p>åŸºäºä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆè¯¢é—®æ˜¯å¦éœ€è¦å®‰è£… react-routerï¼Œå¹¶è¿”å› isRouter æ˜¯å¦ä¸º trueï¼Œå¦‚æœä¸º true æ—¶ï¼Œå°† react-router çš„æ¨¡æ¿æ–‡ä»¶æ·»åŠ åˆ°è¾“å‡ºç›®å½•ä¸­ï¼ŒåŒæ—¶ä¿®æ”¹ App.tsx å’Œ main.tsx çš„ä»£ç ï¼š</p><div class="language-ts"><pre><code><span class="token keyword">if</span> <span class="token punctuation">(</span>isRouter<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">copyTemplateFile</span><span class="token punctuation">(</span><span class="token string">&#39;router&#39;</span><span class="token punctuation">)</span>\n  <span class="token comment">// @ts-ignore</span>\n  <span class="token keyword">let</span> <span class="token punctuation">{</span> packages<span class="token punctuation">,</span> App<span class="token punctuation">,</span> Main<span class="token punctuation">,</span> Antd_App<span class="token punctuation">,</span> Antd_Main <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span>\n    <span class="token string">&#39;../router-templates/index.js&#39;</span>\n  <span class="token punctuation">)</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>isAntd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    App <span class="token operator">=</span> Antd_App\n    Main <span class="token operator">=</span> Antd_Main\n  <span class="token punctuation">}</span>\n  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>AppComponent<span class="token punctuation">,</span> App<span class="token punctuation">)</span>\n  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>MainComponent<span class="token punctuation">,</span> Main<span class="token punctuation">)</span>\n\n  pkg<span class="token punctuation">.</span>dependencies <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>pkg<span class="token punctuation">.</span>dependencies<span class="token punctuation">,</span> <span class="token operator">...</span>packages <span class="token punctuation">}</span>\n  <span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;package.json&#39;</span><span class="token punctuation">,</span> templateDir<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>pkg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;\\n&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="é›†æˆ-redux-toolkit-ä½œä¸ºçŠ¶æ€ç®¡ç†"><a class="header-anchor" href="#é›†æˆ-redux-toolkit-ä½œä¸ºçŠ¶æ€ç®¡ç†" aria-hidden="true">#</a> é›†æˆ Redux toolkit ä½œä¸ºçŠ¶æ€ç®¡ç†</h2><p><img src="/blog/_assets/redux-toolkit-logo.287a2c4c.png" alt="redux-toolkit-logo.png"></p><h3 id="ä¸ºä»€ä¹ˆæ˜¯-redux-toolkit"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆæ˜¯-redux-toolkit" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆæ˜¯ Redux toolkit</h3><p><a href="https://cn.redux.js.org/redux-toolkit/overview/" target="_blank" rel="noopener noreferrer">Redux Toolkit</a> æ˜¯ Redux å®˜æ–¹å¼ºçƒˆæ¨èï¼Œå¼€ç®±å³ç”¨çš„ä¸€ä¸ªé«˜æ•ˆçš„ Redux å¼€å‘å·¥å…·é›†ã€‚å®ƒæ—¨åœ¨æˆä¸ºæ ‡å‡†çš„ Redux é€»è¾‘å¼€å‘æ¨¡å¼ï¼Œå¼ºçƒˆå»ºè®®ä½ ä½¿ç”¨å®ƒã€‚</p><p>ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>ä¼˜åŒ– Redux ä¸­é—´ä»¶ã€å„ç§é…ç½®ä»¥åŠä¹¦å†™ç›®å½•è§„èŒƒç­‰ï¼Œç®€åŒ–æ“ä½œï¼Œä¾‹å¦‚å–ä»£ Redux ä¸­å¾ˆæ¶å¿ƒçš„ typesã€actionsã€reducersï¼›</li><li>React-Redux Hook API å–ä»£éº»çƒ¦çš„<code>connect</code>å’Œ<code>mapState</code>ï¼›</li><li>Reducer ä¸­é»˜è®¤ä½¿ç”¨ Immer æ¥æ›´æ–° Immutable æ•°æ®ï¼Œä¸ç”¨å†è¿”å› stateï¼Œç®€å•ã€çœäº‹ï¼›</li><li>å°è£…å¥½äº† redux-devtools-extensionï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼›</li><li>å·²ç»é›†æˆ redux-thunkï¼Œä¸éœ€è¦å†æ¬¡å®‰è£…ï¼›</li><li>æŒ‰ feature ç»„ç»‡ Redux é€»è¾‘ï¼Œæ›´åŠ æ¸…æ™°ã€‚</li></ul><p>æ€»ä½“æ¥è¯´ï¼ŒRedux Toolkit çš„å‡ºç°è®©ä¹‹å‰æƒ³å°è¯• Reduxï¼Œä½†åˆè¢« Redux å„ç§ç¹ççš„é…ç½®åŠé€€çš„äººé‡æ–°å½’ä½ ğŸ˜„ã€‚</p><h3 id="redux-toolkit-ä½¿ç”¨æ•™ç¨‹"><a class="header-anchor" href="#redux-toolkit-ä½¿ç”¨æ•™ç¨‹" aria-hidden="true">#</a> Redux Toolkit ä½¿ç”¨æ•™ç¨‹</h3><p>å‚è€ƒï¼š<a href="https://redux.js.org/usage/usage-with-typescript#define-typed-hooks" target="_blank" rel="noopener noreferrer">https://redux.js.org/usage/usage-with-typescript#define-typed-hooks</a></p><ol><li><p>æ·»åŠ  Redux Toolkit ç›¸å…³ä¾èµ–ï¼›</p><div class="language-bash"><pre><code><span class="token function">yarn</span> <span class="token function">add</span> @reduxjs/toolkit react-redux\n</code></pre></div></li><li><p>åˆ›å»º store æ–‡ä»¶å¤¹ï¼›</p><p>store ä¸­åŒ…å« featureï¼ˆåŒ…å«æ‰€æœ‰çš„ Sliceï¼‰ã€hooksï¼ˆå°è£… useSelector å’Œ useDispatchï¼‰ã€indexï¼ˆä¸»å…¥å£æ–‡ä»¶ï¼‰</p><div class="language-bash"><pre><code>store\nâ”‚   â”œâ”€â”€ feature\nâ”‚   â”‚   â””â”€â”€ appSlice.ts\nâ”‚   â”œâ”€â”€ hooks.ts\nâ”‚   â””â”€â”€ index.ts\n</code></pre></div></li><li><p>index.ts å…¥å£ï¼›</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> configureStore<span class="token punctuation">,</span> ThunkAction<span class="token punctuation">,</span> Action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@reduxjs/toolkit&#39;</span>\n<span class="token keyword">import</span> appReducer <span class="token keyword">from</span> <span class="token string">&#39;./feature/appSlice&#39;</span>\n<span class="token comment">// åˆ›å»ºstore</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token comment">// featureä¸­åˆ›å»ºå¤šä¸ªå­reducer æœ€ç»ˆåœ¨è¿™é‡Œè¿›è¡Œåˆå¹¶</span>\n  reducer<span class="token operator">:</span> <span class="token punctuation">{</span>\n    app<span class="token operator">:</span> appReducer<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// ä¸­é—´ä»¶</span>\n  <span class="token function-variable function">middleware</span><span class="token operator">:</span> <span class="token punctuation">(</span>getDefaultMiddleware<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>\n    <span class="token function">getDefaultMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      serializableCheck<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token comment">// redux-devtools-extensionä½•æ—¶å¼€å¯</span>\n  devTools<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">AppDispatch</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> store<span class="token punctuation">.</span>dispatch\n<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">RootState</span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> store<span class="token punctuation">.</span>getState<span class="token operator">&gt;</span>\n<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">AppThunk<span class="token operator">&lt;</span>ReturnType <span class="token operator">=</span> <span class="token keyword">void</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> ThunkAction<span class="token operator">&lt;</span>\n  ReturnType<span class="token punctuation">,</span>\n  RootState<span class="token punctuation">,</span>\n  <span class="token builtin">unknown</span><span class="token punctuation">,</span>\n  Action<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span>\n<span class="token operator">&gt;</span>\n</code></pre></div><blockquote><p>serializableCheck: false å…³é—­ serializableCheck æ£€æŸ¥ï¼Œå½“æ•°æ®è¾ƒå¤æ‚æ—¶ï¼Œå¼€å¯æ—¶ä¼šæŠ¥é”™ï¼› @reduxjs/toolkit å·²ç»å°è£…å¥½äº† redux-devtools-extensionï¼Œé€šè¿‡ devTools: true å¼€å¯ã€‚</p></blockquote></li><li><p>hooks.ts é’©å­</p><p>å®˜æ–¹æ¨èä½¿ç”¨ useAppSelector æ¥æ“ä½œ store æ•°æ®ï¼Œä½¿ç”¨ useAppDispatch è§¦å‘å­ store ä¸­çš„ actionã€‚</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> TypedUseSelectorHook<span class="token punctuation">,</span> useDispatch<span class="token punctuation">,</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span>\n<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> RootState<span class="token punctuation">,</span> AppDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;.&#39;</span>\n\n<span class="token comment">// Use throughout your app instead of plain `useDispatch` and `useSelector`</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useAppDispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token generic-function"><span class="token function">useDispatch</span><span class="token generic class-name"><span class="token operator">&lt;</span>AppDispatch<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> useAppSelector<span class="token operator">:</span> TypedUseSelectorHook<span class="token operator">&lt;</span>RootState<span class="token operator">&gt;</span> <span class="token operator">=</span> useSelector\n</code></pre></div></li><li><p>å°† Redux è¿æ¥åˆ° React</p><p>åœ¨ main.tsx ä¸­ï¼Œä½¿ç”¨ react-redux çš„ Provider ç»„ä»¶å°† store æ³¨å…¥åˆ°ä¸Šä¸‹æ–‡ä¸­ï¼Œå’Œä¹‹å‰æ²¡æœ‰å˜åŒ–</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./store&#39;</span><span class="token punctuation">;</span>\n<span class="token operator">...</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n...\n</span></code></pre></div></li><li><p>ç»„ä»¶ä¸­å¦‚ä½•ä½¿ç”¨</p><p>åœ¨ç»„ä»¶æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨å®˜æ–¹æ¨èçš„ useAppDispatch å’Œ useAppSelectorï¼Œä»æ¯ä¸ªå­ slice ä¸­è·å– actionã€‚</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useAppDispatch<span class="token punctuation">,</span> useAppSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./store/hooks&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span>\n  selectCount<span class="token punctuation">,</span>\n  decremented<span class="token punctuation">,</span>\n  incremented<span class="token punctuation">,</span>\n<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./store/feature/appSlice&#39;</span>\n\n<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> elements <span class="token operator">=</span> <span class="token function">useRoutes</span><span class="token punctuation">(</span>routers<span class="token punctuation">)</span>\n  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">useAppSelector</span><span class="token punctuation">(</span>selectCount<span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useAppDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span>\n          <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginRight<span class="token operator">:</span> <span class="token string">&#39;8px&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span>\n          <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">incremented</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n        <span class="token punctuation">&gt;</span></span><span class="token plain-text">\n          +\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n        ...\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> App\n</code></pre></div></li></ol><h3 id="redux-toolkit-å¼‚æ­¥æ“ä½œ"><a class="header-anchor" href="#redux-toolkit-å¼‚æ­¥æ“ä½œ" aria-hidden="true">#</a> Redux Toolkit å¼‚æ­¥æ“ä½œ</h3><p>åœ¨ Redux ä¸­ï¼Œå¦‚æœéœ€è¦å¼‚æ­¥æ“ä½œåˆ™éœ€è¦å®‰è£… Redux-Thunkï¼Œè€Œ Redux Toolkit å·²ç»å†…ç½®äº† Redux-Thunkï¼Œä¸éœ€è¦å¦å¤–å®‰è£…å’Œé…ç½®ã€‚</p><p>æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ createAsyncThunk å°±èƒ½å®Œæˆå¼‚æ­¥ action çš„åˆ›å»ºã€‚</p><p>ä¸‹é¢ä»¥ä¸€ä¸ªè·å– github ç”¨æˆ·åˆ—è¡¨ä¸ºä¾‹ï¼š</p><h4 id="åˆ›å»º-userslice"><a class="header-anchor" href="#åˆ›å»º-userslice" aria-hidden="true">#</a> åˆ›å»º userSlice</h4><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createSlice<span class="token punctuation">,</span> createAsyncThunk <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@reduxjs/toolkit&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> RootState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;..&#39;</span>\n\n<span class="token keyword">type</span> <span class="token class-name">UserType</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>props<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span>\n<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">UserState</span> <span class="token punctuation">{</span>\n  users<span class="token operator">:</span> UserType<span class="token punctuation">[</span><span class="token punctuation">]</span>\n  total<span class="token operator">:</span> <span class="token builtin">number</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">const</span> initialState<span class="token operator">:</span> UserState <span class="token operator">=</span> <span class="token punctuation">{</span>\n  users<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  total<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// createAsyncThunkåˆ›å»ºä¸€ä¸ªå¼‚æ­¥actionï¼Œreturnå‡ºå»çš„å€¼ï¼Œä¼šåœ¨extraReducersä¸­æ¥æ”¶ï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š</span>\n<span class="token comment">// pendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€fulfilledï¼ˆæˆåŠŸï¼‰ã€rejectedï¼ˆå¤±è´¥ï¼‰</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> getUserData <span class="token operator">=</span> <span class="token function">createAsyncThunk</span><span class="token punctuation">(</span><span class="token string">&#39;user/getList&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;https://api.github.com/search/users?q=wang&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n    <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span>\n  <span class="token keyword">return</span> res\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// åˆ›å»ºä¸€ä¸ª Slice</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> userSlice <span class="token operator">=</span> <span class="token function">createSlice</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  name<span class="token operator">:</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span>\n  initialState<span class="token punctuation">,</span>\n  reducers<span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// Reducer ä¸­é»˜è®¤ä½¿ç”¨ Immer æ¥æ›´æ–° Immutable æ•°æ®ï¼Œä¸ç”¨å†è¿”å› state</span>\n    <span class="token function-variable function">deleteUser</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      state<span class="token punctuation">.</span>users <span class="token operator">=</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>id <span class="token operator">!==</span> payload<span class="token punctuation">)</span>\n      state<span class="token punctuation">.</span>total <span class="token operator">-=</span> <span class="token number">1</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// extraReducers æ¥å— createAsyncThunkçš„çŠ¶æ€</span>\n  <span class="token function">extraReducers</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    builder\n      <span class="token punctuation">.</span><span class="token function">addCase</span><span class="token punctuation">(</span>getUserData<span class="token punctuation">.</span>pending<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;loading...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token comment">// é€šå¸¸åªéœ€è¦æ¥å—fulfilledå³å¯ æ¥æ”¶åˆ°è¿”å›å€¼åœ¨åŒæ­¥åˆ°stateçŠ¶æ€ä¸­å³å¯</span>\n      <span class="token punctuation">.</span><span class="token function">addCase</span><span class="token punctuation">(</span>getUserData<span class="token punctuation">.</span>fulfilled<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        state<span class="token punctuation">.</span>users <span class="token operator">=</span> payload<span class="token punctuation">.</span>items\n        state<span class="token punctuation">.</span>total <span class="token operator">=</span> payload<span class="token punctuation">.</span>total_count\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">addCase</span><span class="token punctuation">(</span>getUserData<span class="token punctuation">.</span>rejected<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> deleteUser <span class="token punctuation">}</span> <span class="token operator">=</span> userSlice<span class="token punctuation">.</span>actions\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">selectUser</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> RootState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>users\n<span class="token keyword">export</span> <span class="token keyword">default</span> userSlice<span class="token punctuation">.</span>reducer\n</code></pre></div><p>åœ¨ userSlice ä¸­æˆ‘ä»¬ä¸»è¦åšäº†è¿™å‡ ä»¶äº‹ï¼š</p><ol><li><p>ä½¿ç”¨ createAsyncThunk åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ action</p><p>é€šè¿‡ createAsyncThunk return å‡ºå»çš„å€¼ï¼Œä¼šåœ¨ extraReducers ä¸­æ¥æ”¶ï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š</p><ul><li>pendingï¼ˆè¿›è¡Œä¸­ï¼‰</li><li>fulfilledï¼ˆæˆåŠŸï¼‰</li><li>ejectedï¼ˆå¤±è´¥ï¼‰</li></ul></li><li><p>é€šè¿‡ extraReducers æ¥æ¥å— createAsyncThunk çš„ç»“æœ</p><p>åœ¨<code>addCase(getUserData.fulfilled..</code>ä¸­è·å–å¼‚æ­¥ç»“æœæˆåŠŸåçš„è¿”å›å€¼ï¼Œç›´æ¥æ›´æ–°åœ¨ state ä¸­ã€‚</p></li><li><p>åˆ›å»ºä¸€ä¸ª deleteUser actionï¼Œç”¨æ¥åˆ é™¤ç”¨æˆ·</p><p>è¿™ä¸€æ­¥ä¸»è¦æ˜¯ä¸ºäº†<strong>æ¼”ç¤º immer çš„ä½œç”¨</strong>ï¼Œå¦‚æœå¯¹ immer ä¸å¤ªç†Ÿæ‚‰çš„åŒå­¦ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://juejin.cn/post/7047450607984541710#heading-18" target="_blank" rel="noopener noreferrer">ä¸å¯å˜æ•°æ®å®ç°-Immer.js</a>ã€‚</p><p>è¦æ˜¯ä»¥å‰åœ¨ Redux ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿™æ ·æ“ä½œï¼š</p><div class="language-ts"><pre><code><span class="token function-variable function">deleteUser</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n <span class="token keyword">return</span> <span class="token punctuation">{</span>\n   <span class="token operator">...</span>state<span class="token punctuation">,</span>\n   users<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>users<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>id <span class="token operator">!==</span> payload<span class="token punctuation">)</span><span class="token punctuation">,</span>\n   count<span class="token operator">:</span> state<span class="token punctuation">.</span>total <span class="token operator">-</span> <span class="token number">1</span>\n <span class="token punctuation">}</span>\n</code></pre></div><p>è€Œä½¿ç”¨ Redux Toolkit ä¹‹åï¼Œåªéœ€è¦è¿™æ ·æ“ä½œï¼š</p><div class="language-ts"><pre><code><span class="token function-variable function">deleteUser</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n   state<span class="token punctuation">.</span>users <span class="token operator">=</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>id <span class="token operator">!==</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   state<span class="token punctuation">.</span>total <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n <span class="token punctuation">}</span><span class="token punctuation">,</span>\n</code></pre></div></li><li><p>åœ¨ä¸»å…¥å£åˆå¹¶åˆ° reducer ä¸­ï¼Œå’Œ appSlice ä¸€æ ·æ“ä½œï¼›</p></li><li><p>ä½¿ç”¨ï¼ŒåŒåŒæ­¥æ“ä½œ</p></li></ol><p>åŸºäºä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆè¯¢é—®æ˜¯å¦éœ€è¦å®‰è£… Redux Toolkitï¼Œå¹¶è¿”å› isRedux æ˜¯å¦ä¸º trueï¼Œå¦‚æœä¸º true æ—¶ï¼Œå°† Redux Toolkit çš„æ¨¡æ¿æ–‡ä»¶æ·»åŠ åˆ°è¾“å‡ºç›®å½•ä¸­ï¼ŒåŒæ—¶ä¿®æ”¹ main.tsx çš„ä»£ç ï¼š</p><div class="language-ts"><pre><code><span class="token keyword">if</span> <span class="token punctuation">(</span>isRedux<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">copyTemplateFile</span><span class="token punctuation">(</span><span class="token string">&#39;redux&#39;</span><span class="token punctuation">)</span>\n  <span class="token comment">// @ts-ignore</span>\n  <span class="token keyword">let</span> <span class="token punctuation">{</span> packages<span class="token punctuation">,</span> Main<span class="token punctuation">,</span> Router_Main<span class="token punctuation">,</span> Antd_Main<span class="token punctuation">,</span> Antd_Router_Main <span class="token punctuation">}</span> <span class="token operator">=</span>\n    <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;../redux-templates/index.js&#39;</span><span class="token punctuation">)</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>isAntd<span class="token punctuation">)</span> Main <span class="token operator">=</span> Antd_Main\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>isRouter<span class="token punctuation">)</span> Main <span class="token operator">=</span> Router_Main\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>isAntd <span class="token operator">&amp;&amp;</span> isRouter<span class="token punctuation">)</span> Main <span class="token operator">=</span> Antd_Router_Main\n  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>MainComponent<span class="token punctuation">,</span> Main<span class="token punctuation">)</span>\n\n  pkg<span class="token punctuation">.</span>dependencies <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>pkg<span class="token punctuation">.</span>dependencies<span class="token punctuation">,</span> <span class="token operator">...</span>packages <span class="token punctuation">}</span>\n  <span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;package.json&#39;</span><span class="token punctuation">,</span> templateDir<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>pkg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;\\n&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="é›†æˆ-react-query-ä½œä¸ºè¯·æ±‚åº“"><a class="header-anchor" href="#é›†æˆ-react-query-ä½œä¸ºè¯·æ±‚åº“" aria-hidden="true">#</a> é›†æˆ react-query ä½œä¸ºè¯·æ±‚åº“</h2><p><img src="/blog/_assets/react-query-logo.581d8b5c.png" alt="react-query-logo"></p><h3 id="ä¸ºä»€ä¹ˆæ˜¯-react-query"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆæ˜¯-react-query" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆæ˜¯ react query</h3><p>ç”¨å®˜æ–¹çš„æ¥è¯´ï¼šReact Query é€šå¸¸è¢«æè¿°ä¸º React ç¼ºå°‘çš„æ•°æ®è·å–(data-fetching)åº“ï¼Œä½†æ˜¯ä»æ›´å¹¿æ³›çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒ<strong>ä½¿ React ç¨‹åºä¸­çš„è·å–ï¼Œç¼“å­˜ï¼ŒåŒæ­¥å’Œæ›´æ–°æœåŠ¡å™¨çŠ¶æ€å˜å¾—è½»è€Œæ˜“ä¸¾</strong>ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè·Ÿç€æˆ‘çš„æµç¨‹çœ‹ä¸€ä¸‹ï¼Œä½ å°±ä¼šå‘ç° react query å¤ªé¦™äº†ã€‚</p><p><img src="/blog/_assets/zhenxiang.e9d079b9.jpg" alt="zhenxiang.jpg"></p><h3 id="react-query-ä½¿ç”¨æ•™ç¨‹"><a class="header-anchor" href="#react-query-ä½¿ç”¨æ•™ç¨‹" aria-hidden="true">#</a> react query ä½¿ç”¨æ•™ç¨‹</h3><p><a href="https://cangsdarm.github.io/react-query-web-i18n/react/" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ•™ç¨‹</a> ä¹Ÿå¯ä»¥çœ‹æˆ‘ä¹‹å‰å†™çš„ä¸€ä¸ªæ•™ç¨‹ï¼š<a href="https://juejin.cn/post/7162005581224968205" target="_blank" rel="noopener noreferrer">react-query ç³»åˆ—ä¸€â€”â€”åŸºç¡€åŠ useQuery ä½¿ç”¨</a></p><ol><li><p>æ·»åŠ  react query å’Œ axios ä¾èµ–</p><div class="language-bash"><pre><code><span class="token function">yarn</span> <span class="token function">add</span> react-query axios\n</code></pre></div></li><li><p>åˆ›å»º api æ–‡ä»¶å¤¹</p><p>api ä¸­åŒ…å« featureï¼ˆåŒ…å«æ‰€æœ‰çš„è¯·æ±‚æ¥å£ï¼‰ã€interface(ç±»å‹ç»Ÿä¸€ç®¡ç†)ã€queryï¼ˆreact query ç›¸å…³é…ç½®ï¼‰ã€requestï¼ˆå°è£… axiosï¼‰ã€‚</p><div class="language-bash"><pre><code>â”œâ”€â”€ api\nâ”‚   â”œâ”€â”€ feature\nâ”‚   â”‚   â””â”€â”€ app.ts\nâ”‚   â”œâ”€â”€ interface.ts\nâ”‚   â”œâ”€â”€ query\nâ”‚   â”‚   â”œâ”€â”€ query.client.ts\nâ”‚   â”‚   â””â”€â”€ query.constant.ts\nâ”‚   â””â”€â”€ request.ts\n</code></pre></div><p>å¯¹äº axiosï¼Œç½‘ä¸Šæœ‰å¤§æŠŠè¿‡æ¸¡å°è£…çš„æ¡ˆä¾‹ ğŸ¤®ï¼Œæˆ‘åªæ˜¯ç®€å•çš„æ·»åŠ äº†è¯·æ±‚æ‹¦æˆªå’Œç›¸åº”æ‹¦æˆªï¼Œæ„Ÿè§‰å°±å·²ç»å¤Ÿç”¨äº†ã€‚</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span>\n<span class="token keyword">import</span> Axios<span class="token punctuation">,</span> <span class="token punctuation">{</span> AxiosRequestConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> resData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./interface&#39;</span>\n\n<span class="token comment">// ç»Ÿä¸€é…ç½®</span>\n<span class="token keyword">const</span> baseURL <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> service <span class="token operator">=</span> Axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  baseURL<span class="token punctuation">,</span>\n  responseType<span class="token operator">:</span> <span class="token string">&#39;json&#39;</span><span class="token punctuation">,</span>\n  timeout<span class="token operator">:</span> <span class="token number">600000</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// è¯·æ±‚æ‹¦æˆª</span>\nservice<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  res<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>token <span class="token operator">=</span> <span class="token string">&#39;token&#39;</span>\n  <span class="token keyword">return</span> res\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// æ‹¦æˆªå“åº”</span>\nservice<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>\n  <span class="token punctuation">(</span>response<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> res <span class="token operator">=</span> response<span class="token punctuation">.</span>data\n    <span class="token comment">// è¿™å—éœ€è¦ä¿®æ”¹ æ ¹æ®è¯·æ±‚è¿”å›æˆåŠŸæ ‡å¿—</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">||</span> res<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>message<span class="token punctuation">)</span> message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>\n      <span class="token keyword">return</span> response\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&#39;/login&#39;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span>\n\n<span class="token comment">// è®¾ç½®è¿”å›å€¼å’Œè¯·æ±‚å€¼èŒƒå‹</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">request</span><span class="token generic class-name"><span class="token operator">&lt;</span>Res <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">Q</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>\n  req<span class="token operator">:</span> AxiosRequestConfig <span class="token operator">&amp;</span> <span class="token punctuation">{</span>\n    data<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">Q</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token function">service</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n    <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> res<span class="token punctuation">.</span>data <span class="token keyword">as</span> resData<span class="token operator">&lt;</span>Res<span class="token operator">&gt;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data <span class="token operator">||</span> res<span class="token punctuation">)</span> <span class="token keyword">as</span> resData<span class="token operator">&lt;</span>Res<span class="token operator">&gt;</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>é¡ºä¾¿çœ‹ä¸‹å¯¼å‡ºçš„ request æ–¹æ³•ï¼Œä¼ å…¥äº†è¿”å›å’Œè¯·æ±‚å€¼çš„ç±»å‹ï¼Œç„¶ååœ¨ app.ts ä¸­ï¼Œä½¿ç”¨ request å‘é€è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬åªè¦ä¼ å…¥åç«¯çš„è¿”å›ç±»å‹ï¼Œè¿™æ ·åœ¨æ¥å£è¯·æ±‚å®Œæˆåï¼Œä½¿ç”¨æ•°æ®çš„æ—¶å€™å°±ä¼šæ–¹ä¾¿å¾ˆå¤šï¼Œè¿™å°±æ˜¯ TS çš„å¥½å¤„ ğŸ®ã€‚</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> GithubType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../interface&#39;</span>\n<span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">&#39;../request&#39;</span>\n\n<span class="token comment">/* ç”¨æˆ·åˆ—è¡¨ */</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getUserList</span> <span class="token operator">=</span> <span class="token punctuation">(</span>searchName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>\n  <span class="token generic-function"><span class="token function">request</span><span class="token generic class-name"><span class="token operator">&lt;</span>GithubType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/search/users?q=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>searchName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n    method<span class="token operator">:</span> <span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div><p><img src="/blog/_assets/axios-ts-resdata.36e6d00b.gif" alt="axios-ts-resdata"></p><p>query.client.ts ç”¨äºåˆå§‹åŒ– react queryï¼Œå¯¼å‡º client ä¼šåœ¨ QueryClientProvider ä¸­è¿›è¡Œé€ä¼ ã€‚</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> QueryClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-query&#39;</span>\n<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// client.setQueryDefaults(QUERY_CHAT_TRANSLATE_INPUT, {</span>\n<span class="token comment">//   select: (res) =&gt; res.data,</span>\n<span class="token comment">//   enabled: false,</span>\n<span class="token comment">// });</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> client\n</code></pre></div><p>query.constant.ts ç”¨äºç»Ÿä¸€ç®¡ç† react query æ‰€æœ‰çš„ keyï¼Œ<strong>key æœ‰ä»€ä¹ˆç”¨å‘¢</strong>ï¼Ÿè¿™ä¸ªåªè¦ä½ æŠŠ react query ç”¨èµ·æ¥å°±å¯ä»¥çŸ¥é“ key çš„ä½œç”¨äº†ã€‚</p><div class="language-ts"><pre><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">QUERY_USER_LIST</span> <span class="token operator">=</span> <span class="token string">&#39;user/list&#39;</span>\n</code></pre></div></li><li><p>åœ¨ main.tsx ä¸­é…ç½®</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> QueryClientProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-query&#39;</span>\n<span class="token keyword">import</span> client <span class="token keyword">from</span> <span class="token string">&#39;./api/query/query.client&#39;</span>\n<span class="token operator">...</span>\n\nReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">QueryClientProvider</span></span> <span class="token attr-name">client</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n    </span><span class="token punctuation">{</span><span class="token comment">/* æ·»åŠ devtools */</span><span class="token punctuation">}</span><span class="token plain-text">\n    </span><span class="token punctuation">{</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;development&#39;</span> <span class="token operator">?</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ReactQueryDevtools</span></span>\n         <span class="token attr-name">initialIsOpen</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>\n         <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom-right<span class="token punctuation">&quot;</span></span>\n       <span class="token punctuation">/&gt;</span></span>\n    <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>\n      <span class="token string">&#39;&#39;</span>\n    <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">\n  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">QueryClientProvider</span></span><span class="token punctuation">&gt;</span></span>\n  <span class="token operator">...</span>\n<span class="token punctuation">)</span>\n</code></pre></div></li><li><p>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</p><p>é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸ä½¿ç”¨ react query çš„æƒ…å†µä¸‹ï¼Œæˆ‘è¦æ—¢è¦é€šè¿‡ useState ç®¡ç† loading å’Œæ•°æ®çŠ¶æ€ï¼Œè¿˜å¾—é€šè¿‡ useEffect æ¥å‘é€è¯·æ±‚ï¼›è€Œä½¿ç”¨ react-query çš„æƒ…å†µä¸‹ï¼Œå„ç§<strong>æ•°æ®çŠ¶æ€ç›´æ¥å¯ä»¥ä½¿ç”¨ useQuery æ¥ä»£æ›¿</strong>ï¼Œç®€åŒ–æˆ‘ä»¬çš„ä»£ç ã€‚</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getUserList <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/api/feature/app&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> UserType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/api/interface&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">QUERY_USER_LIST</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/api/query/query.constant&#39;</span>\n<span class="token comment">// import React, { useEffect, useState } from &#39;react&#39;;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useQuery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-query&#39;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">QueryDemo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ä¸ä½¿ç”¨react-queryæ—¶çš„è¯·æ±‚</span>\n  <span class="token comment">// const [loading, setLoading] = useState(false);</span>\n  <span class="token comment">// const [users, setUsers] = useState&lt;UserType[]&gt;([]);</span>\n  <span class="token comment">// const getList = () =&gt; {</span>\n  <span class="token comment">//   setLoading(true);</span>\n  <span class="token comment">//   getUserList(&#39;wang&#39;)</span>\n  <span class="token comment">//     .then((res) =&gt; setUsers(res.items))</span>\n  <span class="token comment">//     .finally(() =&gt; setLoading(false));</span>\n  <span class="token comment">// };</span>\n  <span class="token comment">// useEffect(() =&gt; getList(), []);</span>\n  <span class="token comment">// ä½¿ç”¨react-query</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> users<span class="token punctuation">,</span> isLoading<span class="token operator">:</span> loading <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>\n    <span class="token constant">QUERY_USER_LIST</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token string">&#39;wang&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token function-variable function">select</span><span class="token operator">:</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span>items<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">)</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n      </span><span class="token punctuation">{</span>loading <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n        </span><span class="token punctuation">{</span>users<span class="token operator">?.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user<span class="token operator">:</span> UserType<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>id <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>login<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>\n        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> QueryDemo\n</code></pre></div></li></ol><p>åŸºäºä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆè¯¢é—®æ˜¯å¦éœ€è¦å®‰è£… react-queryï¼Œå¹¶è¿”å› isQuery æ˜¯å¦ä¸º trueï¼Œå¦‚æœä¸º true æ—¶ï¼Œå°† react-query çš„æ¨¡æ¿æ–‡ä»¶æ·»åŠ åˆ°è¾“å‡ºç›®å½•ä¸­ï¼ŒåŒæ—¶ä¿®æ”¹ main.tsx çš„ä»£ç ï¼š</p><div class="language-ts"><pre><code><span class="token keyword">if</span> <span class="token punctuation">(</span>isQuery<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">copyTemplateFile</span><span class="token punctuation">(</span><span class="token string">&#39;query&#39;</span><span class="token punctuation">)</span>\n  <span class="token comment">// è·å–æ¨¡æ¿ä¸‹çš„æ–‡ä»¶ å°†é™¤äº†package.jsonçš„æ–‡ä»¶å…¨éƒ¨å¤åˆ¶åˆ°è¾“å‡ºç›®å½•ä¸­</span>\n  <span class="token keyword">const</span> MainComponent <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">,</span> <span class="token string">&#39;./src/Main.tsx&#39;</span><span class="token punctuation">)</span>\n  <span class="token comment">// @ts-ignore</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> packages<span class="token punctuation">,</span> Main <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;../query-templates/index.js&#39;</span><span class="token punctuation">)</span>\n  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>MainComponent<span class="token punctuation">,</span> Main<span class="token punctuation">)</span>\n\n  pkg<span class="token punctuation">.</span>dependencies <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>pkg<span class="token punctuation">.</span>dependencies<span class="token punctuation">,</span> <span class="token operator">...</span>packages <span class="token punctuation">}</span>\n  <span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;package.json&#39;</span><span class="token punctuation">,</span> templateDir<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>pkg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;\\n&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>ğŸ‰ğŸ‰ğŸ‰ åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦åšçš„äº‹æƒ…éƒ½å·²ç»å®Œæˆäº†ï¼æ¥ä¸‹æ¥å°±æ˜¯å‘å¸ƒ npm åŒ…ã€‚</p><h2 id="å‘å¸ƒ-npm"><a class="header-anchor" href="#å‘å¸ƒ-npm" aria-hidden="true">#</a> å‘å¸ƒ npm</h2><div class="language-json"><pre><code><span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n  <span class="token property">&quot;create-vct&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;cvt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n  <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>\n  <span class="token string">&quot;template-*&quot;</span><span class="token punctuation">,</span>\n  <span class="token string">&quot;*-templates&quot;</span><span class="token punctuation">,</span>\n  <span class="token string">&quot;dist&quot;</span>\n<span class="token punctuation">]</span><span class="token punctuation">,</span>\n</code></pre></div><p>å‘å¸ƒ npm åŒ…æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†æ‰€æœ‰æ¨¡æ¿æ–‡ä»¶éƒ½å‘å¸ƒï¼Œä¿®æ”¹ package.json çš„<code>files</code>å¦‚ä¸Šæ‰€ç¤ºï¼Œfiles å°±æ˜¯å‘å¸ƒåˆ° npm ä»“åº“çš„æ–‡ä»¶ã€‚</p><p>bin å­—æ®µä¿®æ”¹ä¸º<code>create-vct</code>ï¼Œè¿™æ ·åœ¨æ‰§è¡Œ<code>create-vct</code>å‘½ä»¤æ—¶æœ€ç»ˆæ‰§è¡Œçš„æ–‡ä»¶å°±æ˜¯ index.jsã€‚</p><p><img src="/blog/_assets/package-bin.b08f13f1.png" alt="package-bin.png"></p><blockquote><p>bin é‡Œçš„å‘½ä»¤å¯¹åº”çš„æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œé€šè¿‡è½¯é“¾æ¥æˆ–è€…ç¬¦å·é“¾æ¥åˆ°æŒ‡å®šèµ„æºçš„æ˜ å°„ï¼Œè¿™äº›å¯æ‰§è¡Œæ–‡ä»¶å¿…é¡»ä»¥ #!/usr/bin/env node å¼€å¤´ï¼Œå¦åˆ™è„šæœ¬å°†åœ¨æ²¡æœ‰ node å¯æ‰§è¡Œæ–‡ä»¶çš„æƒ…å†µä¸‹å¯åŠ¨ã€‚</p></blockquote><p>ä¿®æ”¹å®Œæˆåï¼Œæ‰§è¡Œ</p><div class="language-bash"><pre><code><span class="token function">pnpm</span> build\nnrm use <span class="token function">npm</span>\n<span class="token function">npm</span> publish\n</code></pre></div><h2 id="å¦‚ä½•ä½¿ç”¨"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨" aria-hidden="true">#</a> å¦‚ä½•ä½¿ç”¨</h2><ul><li><p>å…¨å±€å®‰è£…</p><div class="language-bash"><pre><code><span class="token function">npm</span> i create-vct -g\ncreate-vct\n</code></pre></div><p>å…¨å±€å®‰è£…åï¼Œç›´æ¥åœ¨æ§åˆ¶å°è¾“å…¥<code>create-vct</code>å³å¯ã€‚</p></li><li><p>ä½¿ç”¨ npx</p><p>npm ä» 5.25.2 ç‰ˆå¼€å§‹ï¼Œå¢åŠ äº† npx å‘½ä»¤ï¼Œå¯ä»¥è®©æˆ‘ä»¬åœ¨å½“å‰è·¯å¾„ä½¿ç”¨å…¨å±€åŒ…ã€‚npx è¿è¡Œæ—¶ï¼Œä¼šåˆ°å½“å‰ node_modules/.bin è·¯å¾„å’Œç¯å¢ƒå˜é‡$PATH é‡Œé¢ï¼Œæ£€æŸ¥å‘½ä»¤æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæ‰¾ä¸åˆ°æ—¶ä¼šä» npm ä¸Šä¸‹è½½æœ€æ–°ç‰ˆæœ¬ä½¿ç”¨ã€‚</p><div class="language-bash"><pre><code>npx create-vct\n</code></pre></div></li></ul><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>æ•´ä¸ªæµç¨‹èµ°ä¸‹æ¥ï¼ŒçœŸçš„æ˜¯æ”¶è·å¾ˆå¤šï¼Œå­¦åˆ°äº† node æ“ä½œæ–‡ä»¶çš„å¾ˆå¤š apiã€‚å¯¹ react-routerã€redux-toolkit å’Œ react-query åˆé‡æ–°å›é¡¾äº†ä¸€éã€‚ä¹‹å‰åšçš„ç™½æ¿è¦æ´¾ä¸Šç”¨åœºäº†ï¼Œæˆ‘ç”¨å®ƒæ¥åšæ¯ä¸ªæ¨¡å—çš„å›¾ï¼ˆè™½ç„¶ç•¥ä¸‘ ğŸ˜…ï¼‰ï¼ŒåŒæ—¶è¿˜å­¦ç€åšäº†ä¸€ä¸‹ svg çš„å›¾æ ‡ï¼Œå¯è°“æ˜¯æ”¶è·æ»¡æ»¡ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµå’Œæ”¶è— ğŸ™ï¼Œå¦‚æœå‘ç°æœ‰ä»€ä¹ˆé”™è¯¯æˆ–è€…æ›´å¥½çš„è§£å†³æ–¹æ¡ˆåŠå»ºè®®ï¼Œæ¬¢è¿éšæ—¶è”ç³»ã€‚</p><p>æœ¬æ–‡é¡¹ç›®åœ°å€ï¼Œ<a href="https://github.com/wang1xiang/create-vct" target="_blank" rel="noopener noreferrer">https://github.com/wang1xiang/create-vct</a> æ¬¢è¿ starã€‚</p>',108)];p.render=function(a,t,p,e,c,l){return n(),s("div",null,o)};export{t as __pageData,p as default};
