import{f as e,g as t,J as o}from"./common-03e46d7f.js";const r='{"title":"node:16 docker 换小镜像","frontmatter":{"date":"2024-05-08","title":"node:16 docker 换小镜像","tags":["work"],"describe":"node:16 docker 换小镜像"},"headers":[{"level":2,"title":"现状","slug":"现状"},{"level":2,"title":"替换方法","slug":"替换方法"},{"level":3,"title":"常规项目","slug":"常规项目"},{"level":3,"title":"引用 git+https:// 的项目","slug":"引用-git-https-的项目"},{"level":2,"title":"效果","slug":"效果"}],"relativePath":"docs/work/node16-docker.md","lastUpdated":1742819971373.535}';var d={};const a=[o('<h2 id="现状"><a class="header-anchor" href="#现状" aria-hidden="true">#</a> 现状</h2><p>原来 docker node:16 的镜像加上代码在 1G 左右 <img src="/blog/_assets/node16-docer-replace.fe90b25b.png" alt="node16-docker-replace"></p><h2 id="替换方法"><a class="header-anchor" href="#替换方法" aria-hidden="true">#</a> 替换方法</h2><h3 id="常规项目"><a class="header-anchor" href="#常规项目" aria-hidden="true">#</a> 常规项目</h3><div class="language-"><pre><code># Dockerfile\n- FROM node:16\n+ FROM node:16.19-slim\n# .gitlab-ci.yml\n提换  node:16  为 node:16.19-slim\n</code></pre></div><h3 id="引用-git-https-的项目"><a class="header-anchor" href="#引用-git-https-的项目" aria-hidden="true">#</a> 引用 git+https:// 的项目</h3><p>参考 <a href="https://git.qmpoa.com/fe/y-websocket-excel/-/merge_requests/8/diffs" target="_blank" rel="noopener noreferrer">https://git.qmpoa.com/fe/y-websocket-excel/-/merge_requests/8/diffs</a></p><p><img src="/blog/_assets/node16-docker-replace2.689fcd04.png" alt="node16-docker-replace2"><img src="/blog/_assets/node16-docker-replace3.3b482eca.png" alt="node16-docker-replace3"><img src="/blog/_assets/node16-docker-replace4.563b02b6.png" alt="node16-docker-replace4"> node:16.19-slim 不认</p><div class="language-"><pre><code>&quot;y-luckysheet&quot;: &quot;git+https://git.qmpoa.com/fe_common_lib/y-luckysheet.git#v1.0.1&quot;,\n</code></pre></div><p>这种语法，需要在 CI 流程中将这类依赖处理好，在 Dockerfile 中拷贝进 node_modules 下</p><div class="language-"><pre><code># 在上一步的基础上\n# .gitlab-ci.yml\n  script:\n    - echo &quot;=====start deploy======&quot;\n    - mkdir nm\n    - cd nm\n　 # 将咱们自己的依赖以clone的方式放在一个临时目录下\n    - git clone &#39;https://git.qmpoa.com/fe_common_lib/y-luckysheet.git&#39;\n    - cd ../\n# Dockerfile\nRUN npm install --registry=https://registry.npmmirror.com --ignore-scripts --production\n# 在依赖安装完成后，将临时目录下的内容移动到node_modules下\nRUN mv ./nm/y-luckysheet ./node_modules/y-luckysheet\n</code></pre></div><h2 id="效果"><a class="header-anchor" href="#效果" aria-hidden="true">#</a> 效果</h2><p><img src="/blog/_assets/node16-docer-replace1.4b0a46de.png" alt="node16-docker-replace1"></p>',13)];d.render=function(o,r,d,s,l,c){return e(),t("div",null,a)};export{r as __pageData,d as default};
